(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1072:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(a=(l=i.next()).done)&&(n.push(l.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=p(n(1)),l=p(n(0)),i=n(11);n(901);var u=p(n(1615));n(1647);var s=p(n(8)),c=p(n(66)),f=n(10),d=p(n(558));function p(e){return e&&e.__esModule?e:{default:e}}var h=Object.freeze({DEFAULTS:"defaults",CUSTOM_START_END:"custom_start_end",CUSTOM_RANGE:"custom_range"}),m=Object.freeze({LAST:"Last",NEXT:"Next"}),y=["Last day","Last week","Last month","Last quarter","Last year","No filter"],v=["seconds","minutes","hours","days","weeks","months","years"],g="YYYY-MM-DD[T]HH:mm:ss",b=(0,s.default)().startOf("day").subtract(7,"days").format(g),E=(0,s.default)().startOf("day").format(g),C=(0,f.t)("Superset supports smart date parsing. Strings like `last sunday` or `last october` can be used."),O={animation:l.default.bool,name:l.default.string.isRequired,label:l.default.string,description:l.default.string,onChange:l.default.func,value:l.default.string,height:l.default.number},_={animation:!0,onChange:function(){},value:"Last week"};function S(e){return e!==(0,s.default)(e,g).format(g)}var T=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.value||_.value;if(n.state={type:h.DEFAULTS,common:y[0],rel:m.LAST,num:"7",grain:v[3],since:b,until:E,freeformInputs:{}},r.indexOf(" : ")>=0){n.state.type=h.CUSTOM_START_END;var o=r.split(" : ",2),l=a(o,2);n.state.since=l[0],n.state.until=l[1]}else if(n.state.type=h.DEFAULTS,y.indexOf(r)>=0)n.state.common=r;else{n.state.common=null;var i=r.split(" ",3),u=a(i,3);n.state.rel=u[0],n.state.num=u[1],n.state.grain=u[2]}return n.state.freeformInputs.since=S(n.state.since),n.state.freeformInputs.until=S(n.state.until),n.dateTimeFieldRefs={},n.handleClick=n.handleClick.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClick)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClick)}},{key:"onEnter",value:function(e){"Enter"===e.key&&this.close()}},{key:"setDefaults",value:function(e){var t={type:h.DEFAULTS,common:e,until:(0,s.default)().startOf("day").format(g)},n=e.split(" ")[1]+"s";t.since=(0,s.default)().startOf("day").subtract(1,n).format(g),this.setState(t,this.updateRefs)}},{key:"setCustomRange",value:function(e,t){var n=Object.assign({},this.state,{type:h.CUSTOM_RANGE});void 0!==e&&void 0!==t&&(n[e]=t),n.rel===m.LAST?(n.until=(0,s.default)().startOf("day").format(g),n.since=(0,s.default)().startOf("day").subtract(n.num,n.grain).format(g)):(n.until=(0,s.default)().startOf("day").add(n.num,n.grain).format(g),n.since=(0,s.default)().startOf("day").format(g)),this.setState(n,this.updateRefs)}},{key:"setCustomStartEnd",value:function(e,t){var n={type:h.CUSTOM_START_END,freeformInputs:Object.assign({},this.state.freeformInputs)};if("Invalid date"===t){var a=this.dateTimeFieldRefs[e].state.inputValue;n.freeformInputs[e]=!0,n[e]=a}else n.freeformInputs[e]=!1,n[e]=t;this.setState(n,this.updateRefs)}},{key:"handleClick",value:function(e){this.startEndSectionRef&&this.startEndSectionRef.contains(e.target)&&this.setState({type:h.CUSTOM_START_END})}},{key:"updateRefs",value:function(){this.dateTimeFieldRefs.since.setState({inputValue:this.state.since}),this.dateTimeFieldRefs.until.setState({inputValue:this.state.until})}},{key:"close",value:function(){var e=void 0;e=this.state.type===h.DEFAULTS?this.state.common:this.state.type===h.CUSTOM_RANGE?this.state.rel+" "+this.state.num+" "+this.state.grain:[this.state.since,this.state.until].join(" : "),this.props.onChange(e),this.refs.trigger.hide()}},{key:"renderPopover",value:function(){var e=this,t=v.map((function(t){return o.default.createElement(i.MenuItem,{onSelect:e.setCustomRange.bind(e,"grain"),key:t,eventKey:t,active:t===e.state.grain},t)})),n=y.map((function(t){return o.default.createElement(i.Radio,{key:t.replace(" ","").toLowerCase(),checked:e.state.common===t,onChange:e.setDefaults.bind(e,t)},t)}));return o.default.createElement(i.Popover,{id:"filter-popover",placement:"top",positionTop:0},o.default.createElement("div",{style:{width:"250px"}},o.default.createElement(i.Tabs,{defaultActiveKey:this.state.type===h.DEFAULTS?1:2,id:"type",className:"time-filter-tabs"},o.default.createElement(i.Tab,{eventKey:1,title:"Defaults"},o.default.createElement(i.FormGroup,null,n)),o.default.createElement(i.Tab,{eventKey:2,title:"Custom"},o.default.createElement(i.FormGroup,null,o.default.createElement(d.default,{title:"Relative to today",isSelected:this.state.type===h.CUSTOM_RANGE,onSelect:this.setCustomRange.bind(this)},o.default.createElement("div",{className:"clearfix centered",style:{marginTop:"12px"}},o.default.createElement("div",{style:{width:"60px",marginTop:"-4px"},className:"input-inline"},o.default.createElement(i.DropdownButton,{bsSize:"small",componentClass:i.InputGroup.Button,id:"input-dropdown-rel",title:this.state.rel,onFocus:this.setCustomRange.bind(this)},o.default.createElement(i.MenuItem,{onSelect:this.setCustomRange.bind(this,"rel"),key:m.LAST,eventKey:m.LAST,active:this.state.rel===m.LAST},"Last"),o.default.createElement(i.MenuItem,{onSelect:this.setCustomRange.bind(this,"rel"),key:m.NEXT,eventKey:m.NEXT,active:this.state.rel===m.NEXT},"Next"))),o.default.createElement("div",{style:{width:"60px",marginTop:"-4px"},className:"input-inline"},o.default.createElement(i.FormControl,{bsSize:"small",type:"text",onChange:function(t){return e.setCustomRange.call(e,"num",t.target.value)},onFocus:this.setCustomRange.bind(this),onKeyPress:this.onEnter.bind(this),value:this.state.num,style:{height:"30px"}})),o.default.createElement("div",{style:{width:"90px",marginTop:"-4px"},className:"input-inline"},o.default.createElement(i.DropdownButton,{bsSize:"small",componentClass:i.InputGroup.Button,id:"input-dropdown-grain",title:this.state.grain,onFocus:this.setCustomRange.bind(this)},t)))),o.default.createElement(d.default,{title:"Start / end",isSelected:this.state.type===h.CUSTOM_START_END,onSelect:this.setCustomStartEnd.bind(this),info:C},o.default.createElement("div",{ref:function(t){e.startEndSectionRef=t}},o.default.createElement(i.InputGroup,null,o.default.createElement("div",{style:{margin:"5px 0"}},o.default.createElement(u.default,{ref:function(t){e.dateTimeFieldRefs.since=t},dateTime:this.state.freeformInputs.since?b:this.state.since,defaultText:this.state.since,onChange:this.setCustomStartEnd.bind(this,"since"),maxDate:(0,s.default)(this.state.until,g),format:g,inputFormat:g,onClick:this.setCustomStartEnd.bind(this),inputProps:{onKeyPress:this.onEnter.bind(this),onFocus:this.setCustomStartEnd.bind(this)}})),o.default.createElement("div",{style:{margin:"5px 0"}},o.default.createElement(u.default,{ref:function(t){e.dateTimeFieldRefs.until=t},dateTime:this.state.freeformInputs.until?E:this.state.until,defaultText:this.state.until,onChange:this.setCustomStartEnd.bind(this,"until"),minDate:(0,s.default)(this.state.since,g).add(1,"days"),format:g,inputFormat:g,inputProps:{onKeyPress:this.onEnter.bind(this),onFocus:this.setCustomStartEnd.bind(this)}})))))))),o.default.createElement("div",{className:"clearfix"},o.default.createElement(i.Button,{bsSize:"small",className:"float-right ok",bsStyle:"primary",onClick:this.close.bind(this)},"Ok"))))}},{key:"render",value:function(){var e=this.props.value||_.value;return e=e.split(" : ").map((function(e){return e.replace("T00:00:00","")||"∞"})).join(" : "),o.default.createElement("div",null,o.default.createElement(c.default,this.props),o.default.createElement(i.OverlayTrigger,{animation:this.props.animation,container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},o.default.createElement(i.Label,{style:{cursor:"pointer"}},e)))}}]),t}(o.default.Component);t.default=T,T.propTypes=O,T.defaultProps=_},1082:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(1)),r=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}var l={controls:r.default.arrayOf(r.default.object).isRequired};function i(e){var t=12/e.controls.length;return a.default.createElement("div",{className:"row space-1"},e.controls.map((function(e,n){return a.default.createElement("div",{className:"col-lg-"+t+" col-xs-12",key:n},e)})))}i.propTypes=l,t.default=i},1083:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=u(n(1)),l=u(n(0)),i=u(n(810));function u(e){return e&&e.__esModule?e:{default:e}}var s=Object.keys(i.default),c={actions:l.default.object.isRequired,name:l.default.string.isRequired,type:l.default.oneOf(s).isRequired,hidden:l.default.bool,label:l.default.string.isRequired,choices:l.default.arrayOf(l.default.array),description:l.default.string,tooltipOnClick:l.default.func,places:l.default.number,validators:l.default.array,validationErrors:l.default.array,renderTrigger:l.default.bool,rightNode:l.default.node,formData:l.default.object,value:l.default.oneOfType([l.default.string,l.default.number,l.default.object,l.default.bool,l.default.array,l.default.func])},f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={hovered:!1},n.validate=n.validate.bind(n),n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidMount",value:function(){this.validateAndSetValue(this.props.value,[])}},{key:"onChange",value:function(e,t){this.validateAndSetValue(e,t)}},{key:"setHover",value:function(e){this.setState({hovered:e})}},{key:"validateAndSetValue",value:function(e,t){var n=this.props.validationErrors,a=this.validate(e);t&&t.length>0&&(a=n.concat(t)),n.length+a.length>0&&(n=a),e===this.props.value&&n===this.props.validationErrors||this.props.actions.setControlValue(this.props.name,e,n)}},{key:"validate",value:function(e){var t=this.props.validators,n=[];return t&&t.length>0&&t.forEach((function(t){var a=t(e);a&&n.push(a)})),n}},{key:"render",value:function(){var e=i.default[this.props.type],t=this.props.hidden?{display:"none"}:null;return o.default.createElement("div",{style:t,onMouseEnter:this.setHover.bind(this,!0),onMouseLeave:this.setHover.bind(this,!1)},o.default.createElement(e,a({onChange:this.onChange,hovered:this.state.hovered},this.props)))}}]),t}(o.default.PureComponent);t.default=f,f.propTypes=c,f.defaultProps={renderTrigger:!1,validators:[],hidden:!1,validationErrors:[]}},1084:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=h(n(1)),l=h(n(0)),i=n(11),u=n(40),s=n(226),c=n(281),f=h(n(68)),d=h(n(1085)),p=n(10);function h(e){return e&&e.__esModule?e:{default:e}}var m={colorScheme:l.default.string.isRequired,annotationError:l.default.object,annotationQuery:l.default.object,vizType:l.default.string,validationErrors:l.default.array,name:l.default.string.isRequired,actions:l.default.object,value:l.default.arrayOf(l.default.object),onChange:l.default.func,refreshAnnotationData:l.default.func},y={vizType:"",value:[],annotationError:{},annotationQuery:{},onChange:function(){}},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.addAnnotationLayer=n.addAnnotationLayer.bind(n),n.removeAnnotationLayer=n.removeAnnotationLayer.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.name,n=e.annotationError,a=e.validationErrors,r=e.value;Object.keys(n).length&&!a.length&&this.props.actions.setControlValue(t,r,Object.keys(n)),!Object.keys(n).length&&a.length&&this.props.actions.setControlValue(t,r,[])}},{key:"addAnnotationLayer",value:function(e){var t=e,n=this.props.value.slice(),a=n.findIndex((function(e){return e.name===(t.oldName||t.name)}));delete t.oldName,a>-1?n[a]=t:n=n.concat(t),this.props.refreshAnnotationData(t),this.props.onChange(n)}},{key:"removeAnnotationLayer",value:function(e){var t=this.props.value.slice().filter((function(t){return t.name!==e.oldName}));this.props.onChange(t)}},{key:"renderPopover",value:function(e,t,n){var r=this,l=t?t.name:"_new";return o.default.createElement(i.Popover,{style:{maxWidth:"none"},title:t?(0,p.t)("Edit Annotation Layer"):(0,p.t)("Add Annotation Layer"),id:"annotation-pop-"+l},o.default.createElement(d.default,a({},t,{error:n,colorScheme:this.props.colorScheme,vizType:this.props.vizType,addAnnotationLayer:this.addAnnotationLayer,removeAnnotationLayer:this.removeAnnotationLayer,close:function(){return r.refs[e].hide()}})))}},{key:"renderInfo",value:function(e){var t=this.props,n=t.annotationError;return t.annotationQuery[e.name]?o.default.createElement("i",{className:"fa fa-refresh",style:{color:"orange"},"aria-hidden":!0}):n[e.name]?o.default.createElement(f.default,{label:"validation-errors",bsStyle:"danger",tooltip:n[e.name]}):e.show?"":o.default.createElement("span",{style:{color:"red"}}," Hidden ")}},{key:"render",value:function(){var e=this,t=this.props.value.map((function(t,n){return o.default.createElement(i.OverlayTrigger,{key:n,trigger:"click",rootClose:!0,ref:"overlay-"+n,placement:"right",overlay:e.renderPopover("overlay-"+n,t,e.props.annotationError[t.name])},o.default.createElement(i.ListGroupItem,null,o.default.createElement("span",null,t.name),o.default.createElement("span",{style:{float:"right"}},e.renderInfo(t))))}));return o.default.createElement("div",null,o.default.createElement(i.ListGroup,null,t,o.default.createElement(i.OverlayTrigger,{trigger:"click",rootClose:!0,ref:"overlay-new",placement:"right",overlay:this.renderPopover("overlay-new")},o.default.createElement(i.ListGroupItem,null,o.default.createElement("i",{className:"fa fa-plus"}),"   ",(0,p.t)("Add Annotation Layer")))))}}]),t}(o.default.PureComponent);v.propTypes=m,v.defaultProps=y,t.default=(0,u.connect)((function(e){var t=e.charts,n=e.explore,a=(0,s.getChartKey)(n);return{colorScheme:(n.controls||{}).color_scheme.value,annotationError:t[a].annotationError,annotationQuery:t[a].annotationQuery,vizType:n.controls.viz_type.value}}),(function(e){return{refreshAnnotationData:function(t){return e((0,c.runAnnotationQuery)(t))}}}))(v)},1085:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=C(n(1)),o=C(n(0)),l=n(811),i=n(11),u=C(n(21)),s=C(n(1069)),c=C(n(411)),f=C(n(463)),d=C(n(557)),p=n(561),h=C(p),m=n(244),y=C(n(558)),v=C(n(66)),g=n(279),b=C(n(277)),E=n(10);function C(e){return e&&e.__esModule?e:{default:e}}var O={name:o.default.string,annotationType:o.default.string,sourceType:o.default.string,color:o.default.string,opacity:o.default.string,style:o.default.string,width:o.default.number,showMarkers:o.default.bool,hideLine:o.default.bool,value:o.default.oneOfType([o.default.string,o.default.number]),overrides:o.default.object,show:o.default.bool,titleColumn:o.default.string,descriptionColumns:o.default.arrayOf(o.default.string),timeColumn:o.default.string,intervalEndColumn:o.default.string,vizType:o.default.string,error:o.default.string,colorScheme:o.default.string,addAnnotationLayer:o.default.func,removeAnnotationLayer:o.default.func,close:o.default.func},_={name:"",annotationType:p.DEFAULT_ANNOTATION_TYPE,sourceType:"",color:"",opacity:"",style:"solid",width:1,showMarkers:!1,hideLine:!1,overrides:{},colorScheme:"d3Category10",show:!0,titleColumn:"",descriptionColumns:[],timeColumn:"",intervalEndColumn:"",addAnnotationLayer:function(){},removeAnnotationLayer:function(){},close:function(){}},S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),a=e.name,r=e.annotationType,o=e.sourceType,l=e.color,i=e.opacity,u=e.style,s=e.width,c=e.showMarkers,f=e.hideLine,d=e.value,p=e.overrides,h=e.show,m=e.titleColumn,y=e.descriptionColumns,v=e.timeColumn,g=e.intervalEndColumn;return n.state={name:a,oldName:n.props.name?a:null,annotationType:r,sourceType:o,value:d,overrides:p,show:h,titleColumn:m,descriptionColumns:y,timeColumn:v,intervalEndColumn:g,color:l||"",opacity:i,style:u,width:s,showMarkers:c,hideLine:f,isNew:!n.props.name,isLoadingOptions:!0,valueOptions:[],validationErrors:{}},n.submitAnnotation=n.submitAnnotation.bind(n),n.deleteAnnotation=n.deleteAnnotation.bind(n),n.applyAnnotation=n.applyAnnotation.bind(n),n.fetchOptions=n.fetchOptions.bind(n),n.handleAnnotationType=n.handleAnnotationType.bind(n),n.handleAnnotationSourceType=n.handleAnnotationSourceType.bind(n),n.handleValue=n.handleValue.bind(n),n.isValidForm=n.isValidForm.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){var e=this.state,t=e.annotationType,n=e.sourceType,a=e.isLoadingOptions;this.fetchOptions(t,n,a)}},{key:"componentDidUpdate",value:function(e,t){t.sourceType!==this.state.sourceType&&this.fetchOptions(this.state.annotationType,this.state.sourceType,!0)}},{key:"isValidFormula",value:function(e,t){if(t===h.default.FORMULA)try{s.default.parse(e).compile().eval({x:0})}catch(e){return!0}return!1}},{key:"isValidForm",value:function(){var e=this.state,t=e.name,n=e.annotationType,a=e.sourceType,r=e.value,o=e.timeColumn,l=e.intervalEndColumn,i=[(0,g.nonEmpty)(t),(0,g.nonEmpty)(n),(0,g.nonEmpty)(r)];return a!==p.ANNOTATION_SOURCE_TYPES.NATIVE&&(n===h.default.EVENT&&i.push((0,g.nonEmpty)(o)),n===h.default.INTERVAL&&(i.push((0,g.nonEmpty)(o)),i.push((0,g.nonEmpty)(l)))),i.push(this.isValidFormula(r,n)),!i.filter((function(e){return e})).length}},{key:"handleAnnotationType",value:function(e){this.setState({annotationType:e,sourceType:null,validationErrors:{},value:null})}},{key:"handleAnnotationSourceType",value:function(e){this.setState({sourceType:e,isLoadingOptions:!0,validationErrors:{},value:null})}},{key:"handleValue",value:function(e){this.setState({value:e,descriptionColumns:null,intervalEndColumn:null,timeColumn:null,titleColumn:null,overrides:{since:null,until:null}})}},{key:"fetchOptions",value:function(e,t,n){var a=this;!0===n&&(t===p.ANNOTATION_SOURCE_TYPES.NATIVE?u.default.ajax({type:"GET",url:"/annotationlayermodelview/api/read?"}).then((function(e){var t=e?e.result.map((function(e){return{value:e.id,label:e.name}})):[];a.setState({isLoadingOptions:!1,valueOptions:t})})):(0,p.requiresQuery)(t)?u.default.ajax({type:"GET",url:"/superset/user_slices"}).then((function(t){return a.setState({isLoadingOptions:!1,valueOptions:t.filter((function(t){return(0,p.getSupportedSourceTypes)(e).find((function(e){return e===t.viz_type}))})).map((function(e){return{value:e.id,label:e.title,slice:e}}))})})):this.setState({isLoadingOptions:!1,valueOptions:[]}))}},{key:"deleteAnnotation",value:function(){this.props.close(),this.state.isNew||this.props.removeAnnotationLayer(this.state)}},{key:"applyAnnotation",value:function(){var e=this;if(this.state.name.length){var t={};Object.keys(this.state).forEach((function(n){null!==e.state[n]&&(t[n]=e.state[n])})),delete t.isNew,delete t.valueOptions,delete t.isLoadingOptions,delete t.validationErrors,t.color=""===t.color?null:t.color,this.props.addAnnotationLayer(t),this.setState({isNew:!1,oldName:this.state.name})}}},{key:"submitAnnotation",value:function(){this.applyAnnotation(),this.props.close()}},{key:"renderValueConfiguration",value:function(){var e=this.state,t=e.annotationType,n=e.sourceType,a=e.value,o=e.valueOptions,l=e.isLoadingOptions,i="",u="";return(0,p.requiresQuery)(n)?n===p.ANNOTATION_SOURCE_TYPES.NATIVE?(i="Annotation Layer",u="Select the Annotation Layer you would like to use."):(i="Slice",u="Use a pre defined Superset Slice as a source for annotations and overlays. \n        'your chart must be one of these visualization types:\n        '["+(0,p.getSupportedSourceTypes)(t).map((function(e){return b.default[e].label})).join(", ")+"]'"):t===h.default.FORMULA&&(i="Formula",u="Expects a formula with depending time parameter 'x'\n        in milliseconds since epoch. mathjs is used to evaluate the formulas.\n        Example: '2x+5'"),(0,p.requiresQuery)(n)?r.default.createElement(c.default,{name:"annotation-layer-value",showHeader:!0,hovered:!0,description:u,label:i,placeholder:"",options:o,isLoading:l,value:a,onChange:this.handleValue,validationErrors:a?[]:["Mandatory"]}):t===h.default.FORMULA?r.default.createElement(f.default,{name:"annotation-layer-value",hovered:!0,showHeader:!0,description:u,label:i,placeholder:"",value:a,onChange:this.handleValue,validationErrors:this.isValidFormula(a,t)?["Bad formula."]:[]}):""}},{key:"renderSliceConfiguration",value:function(){var e=this,t=this.state,n=t.annotationType,a=t.sourceType,o=t.value,l=t.valueOptions,i=t.overrides,u=t.titleColumn,s=t.timeColumn,m=t.intervalEndColumn,v=t.descriptionColumns,g=(l.find((function(e){return e.value===o}))||{}).slice;if(a!==p.ANNOTATION_SOURCE_TYPES.NATIVE&&g){var b=(g.data.groupby||[]).concat(g.data.all_columns||[]).map((function(e){return{value:e,label:e}})),E=g.data.include_time?[{value:"__timestamp",label:"__timestamp"}].concat(b):b;return r.default.createElement("div",{style:{marginRight:"2rem"}},r.default.createElement(y.default,{isSelected:!0,onSelect:function(){},title:"Annotation Slice Configuration",info:"This section allows you to configure how to use the slice\n               to generate annotations."},(n===h.default.EVENT||n===h.default.INTERVAL)&&r.default.createElement(c.default,{hovered:!0,name:"annotation-layer-time-column",label:n===h.default.INTERVAL?"Interval Start column":"Event Time Column",description:"This column must contain date/time information.",validationErrors:s?[]:["Mandatory"],clearable:!1,options:E,value:s,onChange:function(t){return e.setState({timeColumn:t})}}),n===h.default.INTERVAL&&r.default.createElement(c.default,{hovered:!0,name:"annotation-layer-intervalEnd",label:"Interval End column",description:"This column must contain date/time information.",validationErrors:m?[]:["Mandatory"],options:b,value:m,onChange:function(t){return e.setState({intervalEndColumn:t})}}),r.default.createElement(c.default,{hovered:!0,name:"annotation-layer-title",label:"Title Column",description:"Pick a title for you annotation.",options:[{value:"",label:"None"}].concat(b),value:u,onChange:function(t){return e.setState({titleColumn:t})}}),n!==h.default.TIME_SERIES&&r.default.createElement(c.default,{hovered:!0,name:"annotation-layer-title",label:"Description Columns",description:"Pick one or more columns that should be shown in the\n                  annotation. If you don't select a column all of them will be shown.",multi:!0,options:b,value:v,onChange:function(t){return e.setState({descriptionColumns:t})}}),r.default.createElement("div",{style:{marginTop:"1rem"}},r.default.createElement(d.default,{hovered:!0,name:"annotation-override-since",label:"Override 'Since'",description:'This controls whether the "Since" field from the current\n                  view should be passed down to the chart containing the annotation data.',value:!!Object.keys(i).find((function(e){return"since"===e})),onChange:function(t){delete i.since,t?e.setState({overrides:Object.assign({},i,{since:null})}):e.setState({overrides:Object.assign({},i)})}}),r.default.createElement(d.default,{hovered:!0,name:"annotation-override-until",label:"Override 'Until'",description:'This controls whether the "Until" field from the current\n                  view should be passed down to the chart containing the annotation data.',value:!!Object.keys(i).find((function(e){return"until"===e})),onChange:function(t){delete i.until,t?e.setState({overrides:Object.assign({},i,{until:null})}):e.setState({overrides:Object.assign({},i)})}}),r.default.createElement(d.default,{hovered:!0,name:"annotation-override-timegrain",label:"Override time grain",description:"This controls whether the time grain field from the current\n                  view should be passed down to the chart containing the annotation data.",value:!!Object.keys(i).find((function(e){return"time_grain_sqla"===e})),onChange:function(t){delete i.time_grain_sqla,delete i.granularity,t?e.setState({overrides:Object.assign({},i,{time_grain_sqla:null,granularity:null})}):e.setState({overrides:Object.assign({},i)})}}),r.default.createElement(f.default,{hovered:!0,name:"annotation-layer-timeshift",label:"Time Shift",description:"Time delta in natural language\n                  (example:  24 hours, 7 days, 56 weeks, 365 days)",placeholder:"",value:i.time_shift,onChange:function(t){return e.setState({overrides:Object.assign({},i,{time_shift:t})})}}))))}return""}},{key:"renderDisplayConfiguration",value:function(){var e=this,t=this.state,n=t.color,a=t.opacity,o=t.style,u=t.width,s=t.showMarkers,p=t.hideLine,g=t.annotationType,b=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(m.ALL_COLOR_SCHEMES[this.props.colorScheme]));return n&&""!==n&&!b.find((function(e){return e.toLowerCase()===n.toLowerCase()}))&&b.push(n),r.default.createElement(y.default,{isSelected:!0,onSelect:function(){},title:(0,E.t)("Display configuration"),info:(0,E.t)("Configure your how you overlay is displayed here.")},r.default.createElement(c.default,{name:"annotation-layer-stroke",label:(0,E.t)("Style"),options:[{value:"solid",label:"Solid"},{value:"dashed",label:"Dashed"},{value:"longDashed",label:"Long Dashed"},{value:"dotted",label:"Dotted"}],value:o,onChange:function(t){return e.setState({style:t})}}),r.default.createElement(c.default,{name:"annotation-layer-opacity",label:(0,E.t)("Opacity"),options:[{value:"",label:"Solid"},{value:"opacityLow",label:"0.2"},{value:"opacityMedium",label:"0.5"},{value:"opacityHigh",label:"0.8"}],value:a,onChange:function(t){return e.setState({opacity:t})}}),r.default.createElement("div",null,r.default.createElement(v.default,{label:(0,E.t)("Color")}),r.default.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.default.createElement(l.CompactPicker,{color:n,colors:b,onChangeComplete:function(t){return e.setState({color:t.hex})}}),r.default.createElement(i.Button,{style:{marginTop:"0.5rem",marginBottom:"0.5rem"},bsStyle:""===n?"success":"default",bsSize:"xsmall",onClick:function(){return e.setState({color:""})}},"Automatic Color"))),r.default.createElement(f.default,{name:"annotation-layer-stroke-width",label:(0,E.t)("Line Width"),isInt:!0,value:u,onChange:function(t){return e.setState({width:t})}}),g===h.default.TIME_SERIES&&r.default.createElement(d.default,{hovered:!0,name:"annotation-layer-show-markers",label:"Show Markers",description:"Shows or hides markers for the time series",value:s,onChange:function(t){return e.setState({showMarkers:t})}}),g===h.default.TIME_SERIES&&r.default.createElement(d.default,{hovered:!0,name:"annotation-layer-hide-line",label:"Hide Line",description:"Hides the Line for the time series",value:p,onChange:function(t){return e.setState({hideLine:t})}}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.isNew,a=t.name,o=t.annotationType,l=t.sourceType,u=t.show,s=this.isValidForm();return r.default.createElement("div",null,this.props.error&&r.default.createElement("span",{style:{color:"red"}},"ERROR: ",this.props.error),r.default.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.default.createElement("div",{style:{marginRight:"2rem"}},r.default.createElement(y.default,{isSelected:!0,onSelect:function(){},title:(0,E.t)("Layer Configuration"),info:(0,E.t)("Configure the basics of your Annotation Layer.")},r.default.createElement(f.default,{name:"annotation-layer-name",label:(0,E.t)("Name"),placeholder:"",value:a,onChange:function(t){return e.setState({name:t})},validationErrors:a?[]:[(0,E.t)("Mandatory")]}),r.default.createElement(d.default,{name:"annotation-layer-hide",label:(0,E.t)("Hide Layer"),value:!u,onChange:function(t){return e.setState({show:!t})}}),r.default.createElement(c.default,{hovered:!0,description:(0,E.t)("Choose the Annotation Layer Type"),label:(0,E.t)("Annotation Layer Type"),name:"annotation-layer-type",options:(0,p.getSupportedAnnotationTypes)(this.props.vizType).map((function(e){return{value:e,label:(0,p.getAnnotationTypeLabel)(e)}})),value:o,onChange:this.handleAnnotationType}),!!(0,p.getSupportedSourceTypes)(o).length&&r.default.createElement(c.default,{hovered:!0,description:"Choose the source of your annotations",label:"Annotation Source",name:"annotation-source-type",options:(0,p.getSupportedSourceTypes)(o).map((function(e){return{value:e,label:(0,p.getAnnotationSourceTypeLabels)(e)}})),value:l,onChange:this.handleAnnotationSourceType}),this.renderValueConfiguration())),this.renderSliceConfiguration(),this.renderDisplayConfiguration()),r.default.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.default.createElement(i.Button,{bsSize:"sm",onClick:this.deleteAnnotation},n?(0,E.t)("Cancel"):(0,E.t)("Remove")),r.default.createElement("div",null,r.default.createElement(i.Button,{bsSize:"sm",disabled:!s,onClick:this.applyAnnotation},(0,E.t)("Apply")),r.default.createElement(i.Button,{bsSize:"sm",disabled:!s,onClick:this.submitAnnotation},(0,E.t)("OK")))))}}]),t}(r.default.PureComponent);t.default=S,S.propTypes=O,S.defaultProps=_},1599:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=p(n(1)),l=p(n(0)),i=n(11),u=p(n(56)),s=n(1600),c=p(n(68)),f=p(n(66)),d=p(n(810));function p(e){return e&&e.__esModule?e:{default:e}}var h={name:l.default.string.isRequired,label:l.default.string,description:l.default.string,placeholder:l.default.string,addTooltip:l.default.string,itemGenerator:l.default.func,keyAccessor:l.default.func,onChange:l.default.func,value:l.default.oneOfType([l.default.array]),isFloat:l.default.bool,isInt:l.default.bool,controlName:l.default.string.isRequired},m={label:null,description:null,onChange:function(){},placeholder:"Empty collection",itemGenerator:function(){return{key:u.default.generate()}},keyAccessor:function(e){return e.key},value:[],addTooltip:"Add an item"},y=(0,s.SortableElement)(i.ListGroupItem),v=(0,s.SortableContainer)(i.ListGroup),g=(0,s.SortableHandle)((function(){return o.default.createElement("i",{className:"fa fa-bars text-primary",style:{cursor:"ns-resize"}})})),b=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onAdd=n.onAdd.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"onChange",value:function(e,t){Object.assign(this.props.value[e],t),this.props.onChange(this.props.value)}},{key:"onAdd",value:function(){this.props.onChange(this.props.value.concat([this.props.itemGenerator()]))}},{key:"onSortEnd",value:function(e){var t=e.oldIndex,n=e.newIndex;this.props.onChange((0,s.arrayMove)(this.props.value,t,n))}},{key:"removeItem",value:function(e){this.props.onChange(this.props.value.filter((function(t,n){return e!==n})))}},{key:"renderList",value:function(){var e=this;if(0===this.props.value.length)return o.default.createElement("div",{className:"text-muted"},this.props.placeholder);var t=d.default[this.props.controlName];return o.default.createElement(v,{useDragHandle:!0,lockAxis:"y",onSortEnd:this.onSortEnd.bind(this)},this.props.value.map((function(n,r){return o.default.createElement(y,{className:"clearfix",key:e.props.keyAccessor(n),index:r},o.default.createElement("div",{className:"pull-left m-r-5"},o.default.createElement(g,null)),o.default.createElement("div",{className:"pull-left"},o.default.createElement(t,a({},n,{onChange:e.onChange.bind(e,r)}))),o.default.createElement("div",{className:"pull-right"},o.default.createElement(c.default,{icon:"times",label:"remove-item",tooltip:"remove item",bsStyle:"primary",onClick:e.removeItem.bind(e,r)})))})))}},{key:"render",value:function(){return o.default.createElement("div",null,o.default.createElement(f.default,this.props),this.renderList(),o.default.createElement(c.default,{icon:"plus-circle",label:"add-item",tooltip:this.props.addTooltip,bsStyle:"primary",className:"fa-lg",onClick:this.onAdd}))}}]),t}(o.default.Component);t.default=b,b.propTypes=h,b.defaultProps=m},1605:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=c(n(1)),o=c(n(0)),l=n(11),i=n(811),u=c(n(66)),s=n(244);function c(e){return e&&e.__esModule?e:{default:e}}var f={onChange:o.default.func,value:o.default.object},d={onChange:function(){}},p={position:"absolute",width:"50px",height:"20px",top:"0px",left:"0px",right:"0px",bottom:"0px"},h={swatch:{width:"50px",height:"20px",position:"relative",padding:"5px",borderRadius:"1px",display:"inline-block",cursor:"pointer",boxShadow:"rgba(0, 0, 0, 0.15) 0px 0px 0px 1px inset, rgba(0, 0, 0, 0.25) 0px 0px 4px inset"},color:Object.assign({},p,{borderRadius:"2px"}),checkboard:Object.assign({},p,{background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==") left center'})},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(e){this.props.onChange(e.rgb)}},{key:"renderPopover",value:function(){return r.default.createElement(l.Popover,{id:"filter-popover",className:"color-popover"},r.default.createElement(i.SketchPicker,{color:this.props.value,onChange:this.onChange,presetColors:s.bnbColors.filter((function(e,t){return t<7}))}))}},{key:"render",value:function(){var e=this.props.value||{r:0,g:0,b:0,a:0},t=Object.assign({},h.color,{background:"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"});return r.default.createElement("div",null,r.default.createElement(u.default,this.props),r.default.createElement(l.OverlayTrigger,{container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},r.default.createElement("div",{style:h.swatch},r.default.createElement("div",{style:h.checkboard}),r.default.createElement("div",{style:t}))))}}]),t}(r.default.Component);t.default=m,m.propTypes=f,m.defaultProps=d},1606:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=s(n(1)),o=s(n(0)),l=n(75),i=s(n(66)),u=n(244);function s(e){return e&&e.__esModule?e:{default:e}}var c={description:o.default.string,label:o.default.string.isRequired,name:o.default.string.isRequired,onChange:o.default.func,value:o.default.string,default:o.default.string,choices:o.default.arrayOf(o.default.array).isRequired,schemes:o.default.object.isRequired,isLinear:o.default.bool},f={choices:[],schemes:{},onChange:function(){}},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={scheme:n.props.value},n.onChange=n.onChange.bind(n),n.renderOption=n.renderOption.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(e){var t=e?e.value:null;this.props.onChange(t),this.setState({scheme:t})}},{key:"renderOption",value:function(e){var t=e.value?this.props.schemes[e.value]:this.props.schemes[f.value],n=t;if(this.props.isLinear){var a=(0,u.colorScalerFactory)(t);n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array(20).keys())).map((function(e){return a(e/20)}))}var o=n.map((function(e,n){return r.default.createElement("li",{key:t+"-"+n,style:{backgroundColor:e,border:"1px solid "+("white"===e?"black":e)}}," ")}));return r.default.createElement("ul",{className:"color-scheme-container"},o)}},{key:"render",value:function(){var e={multi:!1,name:"select-"+this.props.name,placeholder:"Select ("+this.props.choices.length+")",default:this.props.default,options:this.props.choices.map((function(e){return{value:e[0],label:e[1]}})),value:this.props.value,autosize:!1,clearable:!1,onChange:this.onChange,optionRenderer:this.renderOption,valueRenderer:this.renderOption};return r.default.createElement("div",null,r.default.createElement(i.default,this.props),r.default.createElement(l.Creatable,e))}}]),t}(r.default.PureComponent);t.default=d,d.propTypes=c,d.defaultProps=f},1607:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=h(n(1)),o=h(n(0)),l=n(11),i=h(n(21)),u=h(n(66)),s=n(10),c=h(n(1608)),f=h(n(302)),d=h(n(612)),p=h(n(329));function h(e){return e&&e.__esModule?e:{default:e}}var m={onChange:o.default.func,value:o.default.string.isRequired,addDangerToast:o.default.func.isRequired,datasource:o.default.object.isRequired,onDatasourceSave:o.default.func},y={onChange:function(){},onDatasourceSave:function(){}},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={showEditDatasourceModal:!1,filter:"",loading:!0,showDatasource:!1},n.toggleShowDatasource=n.toggleShowDatasource.bind(n),n.toggleEditDatasourceModal=n.toggleEditDatasourceModal.bind(n),n.setSearchRef=n.setSearchRef.bind(n),n.selectDatasource=n.selectDatasource.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(e){this.props.onChange(e),this.setState({showModal:!1})}},{key:"onEnterModal",value:function(){var e=this;this.searchRef&&this.searchRef.focus();var t=this;this.state.datasources||i.default.ajax({type:"GET",url:"/superset/datasources/",success:function(n){var a=n.map((function(t){return{rawName:t.name,connection:t.connection,schema:t.schema,name:r.default.createElement("a",{href:"#",onClick:e.selectDatasource.bind(e,t.uid),className:"datasource-link"},t.name),type:t.type}}));t.setState({loading:!1,datasources:a})},error:function(){t.setState({loading:!1}),this.props.addDangerToast((0,s.t)("Something went wrong while fetching the datasource list"))}})}},{key:"setSearchRef",value:function(e){this.searchRef=e}},{key:"toggleShowDatasource",value:function(){this.setState({showDatasource:!this.state.showDatasource})}},{key:"toggleModal",value:function(){this.setState({showModal:!this.state.showModal})}},{key:"changeSearch",value:function(e){this.setState({filter:e.target.value})}},{key:"selectDatasource",value:function(e){this.setState({showModal:!1}),this.props.onChange(e)}},{key:"toggleEditDatasourceModal",value:function(){this.setState({showEditDatasourceModal:!this.state.showEditDatasourceModal})}},{key:"renderModal",value:function(){}},{key:"renderDatasource",value:function(){var e=this.props.datasource;return r.default.createElement("div",{className:"m-t-10"},r.default.createElement(l.Well,{className:"m-t-0"},r.default.createElement("div",{className:"m-b-10"},r.default.createElement(l.Label,null,r.default.createElement("i",{className:"fa fa-database"})," ",e.database.backend)," "+e.database.name+" "),r.default.createElement(l.Row,{className:"datasource-container"},r.default.createElement(l.Col,{md:6},r.default.createElement("strong",null,"Columns"),e.columns.map((function(e){return r.default.createElement("div",{key:e.column_name},r.default.createElement(f.default,{showType:!0,column:e}))}))),r.default.createElement(l.Col,{md:6},r.default.createElement("strong",null,"Metrics"),e.metrics.map((function(e){return r.default.createElement("div",{key:e.metric_name},r.default.createElement(d.default,{metric:e,showType:!0}))}))))))}},{key:"render",value:function(){return r.default.createElement("div",null,r.default.createElement(u.default,this.props),r.default.createElement(l.OverlayTrigger,{placement:"right",overlay:r.default.createElement(l.Tooltip,{id:"error-tooltip"},(0,s.t)("Click to point to another datasource"))},r.default.createElement(l.Label,{onClick:this.toggleEditDatasourceModal,style:{cursor:"pointer"},className:"m-r-5"},this.props.datasource.name)),r.default.createElement(l.OverlayTrigger,{placement:"right",overlay:r.default.createElement(l.Tooltip,{id:"toggle-datasource-tooltip"},(0,s.t)("Expand/collapse datasource configuration"))},r.default.createElement("a",{href:"#"},r.default.createElement("i",{className:"fa fa-"+(this.state.showDatasource?"minus":"plus")+"-square m-r-5",onClick:this.toggleShowDatasource}))),"table"===this.props.datasource.type&&r.default.createElement(l.OverlayTrigger,{placement:"right",overlay:r.default.createElement(l.Tooltip,{id:"datasource-sqllab"},(0,s.t)("Run SQL queries against this datasource"))},r.default.createElement("a",{href:"/superset/sqllab?datasourceKey="+this.props.value},r.default.createElement("i",{className:"fa fa-flask m-r-5"}))),r.default.createElement(l.Collapse,{in:this.state.showDatasource},this.renderDatasource()),r.default.createElement(c.default,{datasource:this.props.datasource,show:this.state.showEditDatasourceModal,onDatasourceSave:this.props.onDatasourceSave,onHide:this.toggleEditDatasourceModal}))}}]),t}(r.default.PureComponent);v.propTypes=m,v.defaultProps=y,t.default=(0,p.default)(v)},1608:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=f(n(1)),o=f(n(0)),l=n(11),i=f(n(641)),u=n(10),s=f(n(1609)),c=f(n(329));function f(e){return e&&e.__esModule?e:{default:e}}var d=window.$=n(21),p={onChange:o.default.func,datasource:o.default.object,show:o.default.bool.isRequired,onHide:o.default.func,onDatasourceSave:o.default.func,addSuccessToast:o.default.func.isRequired},h={onChange:function(){},onHide:function(){},onDatasourceSave:function(){}},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={showEditDatasource:!1,filter:"",loading:!0,errors:[],showDatasource:!1,datasource:e.datasource},n.toggleShowDatasource=n.toggleShowDatasource.bind(n),n.changeSearch=n.changeSearch.bind(n),n.setSearchRef=n.setSearchRef.bind(n),n.onDatasourceChange=n.onDatasourceChange.bind(n),n.onClickSave=n.onClickSave.bind(n),n.onConfirmSave=n.onConfirmSave.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onClickSave",value:function(){this.dialog.show({title:"Confirm save",bsSize:"medium",actions:[i.default.CancelAction(),i.default.OKAction(this.onConfirmSave)],body:this.renderSaveDialog()})}},{key:"onConfirmSave",value:function(){var e=this,t=this;d.ajax({url:"/datasource/save/",type:"POST",data:{data:JSON.stringify(this.state.datasource)},success:function(t){e.props.addSuccessToast((0,u.t)("The datasource has been saved")),e.props.onDatasourceSave(t),e.props.onHide()},error:function(e){var n=(0,u.t)("An error has occurred");e.responseJSON&&e.responseJSON.error&&(n=e.responseJSON.error),t.dialog.show({title:"Error",bsSize:"medium",bsStyle:"danger",actions:[i.default.DefaultAction("Ok",(function(){}),"btn-danger")],body:n})}})}},{key:"onDatasourceChange",value:function(e,t){this.setState({datasource:e,errors:t})}},{key:"setSearchRef",value:function(e){this.searchRef=e}},{key:"toggleShowDatasource",value:function(){this.setState({showDatasource:!this.state.showDatasource})}},{key:"changeSearch",value:function(e){this.setState({filter:e.target.value})}},{key:"renderSaveDialog",value:function(){return r.default.createElement("div",null,r.default.createElement(l.Alert,{bsStyle:"warning",className:"pointer",onClick:this.hideAlert},r.default.createElement("div",null,r.default.createElement("i",{className:"fa fa-exclamation-triangle"})," ",(0,u.t)("The data source configuration exposed here\n                affects all the charts using this datasource.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways."))),(0,u.t)("Are you sure you want to save and apply changes?"))}},{key:"render",value:function(){var e=this;return r.default.createElement(l.Modal,{show:this.props.show,onHide:this.props.onHide,bsSize:"lg"},r.default.createElement(l.Modal.Header,{closeButton:!0},r.default.createElement(l.Modal.Title,null,r.default.createElement("div",null,r.default.createElement("span",{className:"float-left"},(0,u.t)("Datasource Editor for "),r.default.createElement("strong",null,this.props.datasource.name))))),r.default.createElement(l.Modal.Body,null,this.props.show&&r.default.createElement(s.default,{datasource:this.props.datasource,onChange:this.onDatasourceChange})),r.default.createElement(l.Modal.Footer,null,r.default.createElement("span",{className:"float-right"},r.default.createElement(l.Button,{bsSize:"sm",bsStyle:"primary",className:"m-r-5",onClick:this.onClickSave,disabled:this.state.errors.length>0},(0,u.t)("Save")),r.default.createElement(l.Button,{bsSize:"sm",onClick:this.props.onHide},(0,u.t)("Cancel")),r.default.createElement(i.default,{ref:function(t){e.dialog=t}}))))}}]),t}(r.default.PureComponent);m.propTypes=p,m.defaultProps=h,t.default=(0,c.default)(m)},1609:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatasourceEditor=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=_(n(1)),o=_(n(0)),l=n(11),i=_(n(56)),u=_(n(21)),s=n(10),c=_(n(69)),f=_(n(77)),d=_(n(557)),p=_(n(463)),h=_(n(411)),m=_(n(898)),y=_(n(899)),v=_(n(900)),g=_(n(1611)),b=_(n(376)),E=_(n(902)),C=_(n(904)),O=_(n(329));function _(e){return e&&e.__esModule?e:{default:e}}function S(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}n(1614);var T=function(e,t){return r.default.createElement(d.default,{value:e,onChange:t})},w={fontFamily:"monospace"},k=["STRING","NUMBER","DATETIME"];function R(e){var t=e.title,n=e.collection;return r.default.createElement("div",null,t," ",r.default.createElement(l.Badge,null,n?n.length:0))}function P(e){var t=e.columns,n=e.onChange,a=e.editableColumnName,o=e.showExpression,i=e.allowAddItem,u=e.allowEditDataType,c=e.itemGenerator;return r.default.createElement(g.default,{collection:t,tableColumns:["column_name","type","is_dttm","filterable","groupby"],allowDeletes:!0,allowAddItem:i,itemGenerator:c,expandFieldset:r.default.createElement(x,null,r.default.createElement(E.default,{compact:!0},o&&r.default.createElement(C.default,{fieldKey:"expression",label:"SQL Expression",control:r.default.createElement(p.default,null)}),r.default.createElement(C.default,{fieldKey:"verbose_name",label:(0,s.t)("Label"),control:r.default.createElement(p.default,null)}),u&&r.default.createElement(C.default,{fieldKey:"type",label:(0,s.t)("Data Type"),control:r.default.createElement(h.default,{choices:k,name:"type"})}),r.default.createElement(C.default,{fieldKey:"python_date_format",label:"Datetime Format",descr:r.default.createElement("div",null,(0,s.t)("The pattern of the timestamp format, use "),r.default.createElement("a",{href:"https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior"},(0,s.t)("python datetime string pattern")),(0,s.t)(" expression. If time is stored in epoch format, put `epoch_s` or\n                      `epoch_ms`. Leave `Database Expression`\n                      below empty if timestamp is stored in '\n                      String or Integer(epoch) type")),control:r.default.createElement(p.default,null)}),r.default.createElement(C.default,{fieldKey:"database_expression",label:"Database Expression",descr:r.default.createElement("div",null,(0,s.t)("\n                    The database expression to cast internal datetime\n                    constants to database date/timestamp type according to the DBAPI.\n                    The expression should follow the pattern of\n                    %Y-%m-%d %H:%M:%S, based on different DBAPI.\n                    The string should be a python string formatter\n                    `Ex: TO_DATE('{}', 'YYYY-MM-DD HH24:MI:SS')` for Oracle\n                    Superset uses default expression based on DB URI if this\n                    field is blank.\n                  ")),control:r.default.createElement(p.default,null)}))),columnLabels:{column_name:"Column",type:"Data Type",groupby:"Is Dimension",is_dttm:"Is Temporal",filterable:"Is Filterable"},onChange:n,itemRenderers:{column_name:function(e,t){return a?r.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t}):e},type:function(e){return r.default.createElement(l.Label,{style:{fontSize:"75%"}},e)},is_dttm:T,filterable:T,groupby:T}})}function j(e){var t=e.label,n=e.formElement;return r.default.createElement("div",null,r.default.createElement("div",null,r.default.createElement("strong",null,t)),r.default.createElement("div",null,n))}function x(e){var t=e.children;return r.default.createElement(l.Well,{style:{marginTop:20}},t)}R.propTypes={title:o.default.string,collection:o.default.array},P.propTypes={columns:o.default.array.isRequired,onChange:o.default.func.isRequired,editableColumnName:o.default.bool,showExpression:o.default.bool,allowAddItem:o.default.bool,allowEditDataType:o.default.bool,itemGenerator:o.default.func},P.defaultProps={editableColumnName:!1,showExpression:!1,allowAddItem:!1,allowEditDataType:!1,itemGenerator:function(){return{column_name:"<new column>",filterable:!0,groupby:!0}}},j.propTypes={label:o.default.string,formElement:o.default.node},x.propTypes={children:o.default.node};var M={datasource:o.default.object.isRequired,onChange:o.default.func,addSuccessToast:o.default.func.isRequired,addDangerToast:o.default.func.isRequired},A={onChange:function(){}},N=t.DatasourceEditor=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={datasource:e.datasource,showAlert:!0,errors:[],isDruid:"druid"===e.datasource.type,isSqla:"table"===e.datasource.type,databaseColumns:e.datasource.columns.filter((function(e){return!e.expression})),calculatedColumns:e.datasource.columns.filter((function(e){return!!e.expression})),metadataLoading:!1,activeTabKey:1},n.onChange=n.onChange.bind(n),n.onDatasourcePropChange=n.onDatasourcePropChange.bind(n),n.onDatasourceChange=n.onDatasourceChange.bind(n),n.hideAlert=n.hideAlert.bind(n),n.syncMetadata=n.syncMetadata.bind(n),n.setColumns=n.setColumns.bind(n),n.validateAndChange=n.validateAndChange.bind(n),n.handleTabSelect=n.handleTabSelect.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(){var e=Object.assign({},this.state.datasource,{columns:[].concat(S(this.state.databaseColumns),S(this.state.calculatedColumns))});this.props.onChange(e,this.state.errors)}},{key:"onDatasourceChange",value:function(e){this.setState({datasource:e},this.validateAndChange)}},{key:"onDatasourcePropChange",value:function(e,t){var n=Object.assign({},this.state.datasource,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t));this.setState({datasource:n},this.onDatasourceChange(n))}},{key:"setColumns",value:function(e){this.setState(e,this.validateAndChange)}},{key:"validateAndChange",value:function(){this.validate(this.onChange)}},{key:"mergeColumns",value:function(e){var t=this.state.databaseColumns,n=void 0,a=t.map((function(e){return e.column_name}));e.forEach((function(e){a.indexOf(e.name)<0&&(t=t.concat([{id:i.default.generate(),column_name:e.name,type:e.type,groupby:!0,filterable:!0}]),n=!0)})),n&&this.setColumns({databaseColumns:t})}},{key:"syncMetadata",value:function(){var e=this,t=this.state.datasource,n="/datasource/external_metadata/"+t.type+"/"+t.id+"/";this.setState({metadataLoading:!0});var a=function(t){e.mergeColumns(t),e.props.addSuccessToast((0,s.t)("Metadata has been synced")),e.setState({metadataLoading:!1})},r=function(t){var n=(0,s.t)("An error has occurred");t.responseJSON&&t.responseJSON.error&&(n=t.responseJSON.error),e.props.addDangerToast(n),e.setState({metadataLoading:!1})};u.default.ajax({url:n,type:"GET",success:a,error:r})}},{key:"findDuplicates",value:function(e,t){var n={},a=[];return e.forEach((function(e){var r=t(e);r in n?a.push(r):n[r]=null})),a}},{key:"validate",value:function(e){var t=[],n=void 0,a=this.state.datasource;n=this.findDuplicates(a.columns,(function(e){return e.column_name})),t=t.concat(n.map((function(e){return(0,s.t)("Column name [%s] is duplicated",e)}))),n=this.findDuplicates(a.metrics,(function(e){return e.metric_name})),t=t.concat(n.map((function(e){return(0,s.t)("Metric name [%s] is duplicated",e)})));var r=this.state.calculatedColumns.filter((function(e){return!e.expression&&!e.json}));t=t.concat(r.map((function(e){return(0,s.t)("Calculated column [%s] requires an expression",e.column_name)}))),this.setState({errors:t},e)}},{key:"hideAlert",value:function(){this.setState({showAlert:!1})}},{key:"handleTabSelect",value:function(e){this.setState({activeTabKey:e})}},{key:"renderSettingsFieldset",value:function(){var e=this.state.datasource;return r.default.createElement(E.default,{title:"Basic",item:e,onChange:this.onDatasourceChange},r.default.createElement(C.default,{fieldKey:"description",label:(0,s.t)("Description"),control:r.default.createElement(m.default,{language:"markdown",offerEditInModal:!1})}),r.default.createElement(C.default,{fieldKey:"default_endpoint",label:(0,s.t)("Default URL"),descr:(0,s.t)("Default URL to redirect to when accessing from the datasource list page"),control:r.default.createElement(p.default,null)}),r.default.createElement(C.default,{fieldKey:"filter_select",label:(0,s.t)("Autocomplete filters"),descr:(0,s.t)("Whether to populate autocomplete filters options"),control:r.default.createElement(d.default,null)}),r.default.createElement(C.default,{fieldKey:"owner",label:(0,s.t)("Owner"),descr:(0,s.t)("Owner of the datasource"),control:r.default.createElement(y.default,{dataEndpoint:"/users/api/read",multi:!1,mutator:function(e){return e.pks.map((function(t,n){return{value:t,label:e.result[n].first_name+" "+e.result[n].last_name}}))}}),controlProps:{}}))}},{key:"renderAdvancedFieldset",value:function(){var e=this.state.datasource;return r.default.createElement(E.default,{title:"Advanced",item:e,onChange:this.onDatasourceChange},this.state.isSqla&&r.default.createElement(C.default,{fieldKey:"sql",label:(0,s.t)("SQL"),descr:(0,s.t)("When specifying SQL, the datasource acts as a view. Superset will use this statement as a subquery while grouping and filtering on the generated parent queries."),control:r.default.createElement(m.default,{language:"sql",offerEditInModal:!1})}),this.state.isDruid&&r.default.createElement(C.default,{fieldKey:"json",label:(0,s.t)("JSON"),descr:r.default.createElement("div",null,(0,s.t)("The JSON metric or post aggregation definition.")),control:r.default.createElement(m.default,{language:"json",offerEditInModal:!1})}),r.default.createElement(C.default,{fieldKey:"cache_timeout",label:(0,s.t)("Cache Timeout"),descr:(0,s.t)("The duration of time in seconds before the cache is invalidated"),control:r.default.createElement(p.default,null)}),r.default.createElement(C.default,{fieldKey:"offset",label:(0,s.t)("Hours offset"),control:r.default.createElement(p.default,null)}))}},{key:"renderSpatialTab",value:function(){var e=this.state.datasource.spatials;return r.default.createElement(l.Tab,{title:r.default.createElement(R,{collection:e,title:(0,s.t)("Spatial")}),eventKey:4},r.default.createElement(g.default,{tableColumns:["name","config"],onChange:this.onDatasourcePropChange.bind(this,"spatials"),itemGenerator:function(){return{name:"<new spatial>",type:"<no type>",config:null}},collection:e,allowDeletes:!0,itemRenderers:{name:function(e,t){return r.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t})},config:function(e,t){return r.default.createElement(v.default,{value:e,onChange:t,choices:datasource.all_cols})}}}))}},{key:"renderErrors",value:function(){return this.state.errors.length>0?r.default.createElement(l.Alert,{bsStyle:"danger"},this.state.errors.map((function(e){return r.default.createElement("div",{key:e},e)}))):null}},{key:"renderMetricCollection",value:function(){return r.default.createElement(g.default,{tableColumns:["metric_name","verbose_name","expression"],expandFieldset:r.default.createElement(x,null,r.default.createElement(E.default,null,r.default.createElement(C.default,{fieldKey:"description",label:(0,s.t)("Description"),control:r.default.createElement(p.default,null)}),r.default.createElement(C.default,{fieldKey:"d3format",label:(0,s.t)("D3 Format"),control:r.default.createElement(p.default,null)}),r.default.createElement(C.default,{label:(0,s.t)("Warning Message"),fieldKey:"warning_text",description:(0,s.t)("Warning message to display in the metric selector"),control:r.default.createElement(p.default,null)}))),collection:this.state.datasource.metrics,onChange:this.onDatasourcePropChange.bind(this,"metrics"),itemGenerator:function(){return{metric_name:"<new metric>",verbose_name:"",expression:""}},itemRenderers:{metric_name:function(e,t){return r.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t})},verbose_name:function(e,t){return r.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t})},expression:function(e,t){return r.default.createElement(b.default,{canEdit:!0,title:e,onSaveTitle:t,style:w})},description:function(e,t,n){return r.default.createElement(j,{label:n,formElement:r.default.createElement(p.default,{value:e,onChange:t})})},d3format:function(e,t,n){return r.default.createElement(j,{label:n,formElement:r.default.createElement(p.default,{value:e,onChange:t})})}},allowDeletes:!0})}},{key:"render",value:function(){var e=this,t=this.state.datasource;return r.default.createElement("div",{className:"Datasource"},this.renderErrors(),r.default.createElement(l.Tabs,{id:"table-tabs",onSelect:this.handleTabSelect,defaultActiveKey:1},r.default.createElement(l.Tab,{eventKey:1,title:(0,s.t)("Settings")},1===this.state.activeTabKey&&r.default.createElement("div",null,r.default.createElement(l.Col,{md:6},r.default.createElement(x,null,this.renderSettingsFieldset())),r.default.createElement(l.Col,{md:6},r.default.createElement(x,null,this.renderAdvancedFieldset())))),r.default.createElement(l.Tab,{title:r.default.createElement(R,{collection:this.state.databaseColumns,title:(0,s.t)("Columns")}),eventKey:2},2===this.state.activeTabKey&&r.default.createElement("div",null,r.default.createElement(P,{columns:this.state.databaseColumns,onChange:function(t){return e.setColumns({databaseColumns:t})}}),r.default.createElement(c.default,{bsStyle:"primary",onClick:this.syncMetadata,className:"sync-from-source",disabled:!!t.sql,tooltip:t.sql?(0,s.t)("This option is not yet available for views"):null},(0,s.t)("Sync columns from source")),this.state.metadataLoading&&r.default.createElement(f.default,null))),r.default.createElement(l.Tab,{title:r.default.createElement(R,{collection:this.state.calculatedColumns,title:(0,s.t)("Calculated Columns")}),eventKey:3},3===this.state.activeTabKey&&r.default.createElement(P,{columns:this.state.calculatedColumns,onChange:function(t){return e.setColumns({calculatedColumns:t})},editableColumnName:!0,showExpression:!0,allowAddItem:!0,allowEditDataType:!0,itemGenerator:function(){return{column_name:"<new column>",filterable:!0,groupby:!0,expression:"<enter SQL expression here>",__expanded:!0}}})),r.default.createElement(l.Tab,{title:r.default.createElement(R,{collection:t.metrics,title:(0,s.t)("Metrics")}),eventKey:4},4===this.state.activeTabKey&&this.renderMetricCollection())))}}]),t}(r.default.PureComponent);N.defaultProps=A,N.propTypes=M,t.default=(0,O.default)(N)},1611:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=c(n(1)),o=c(n(0)),l=c(n(56)),i=c(n(69)),u=c(n(902)),s=n(903);function c(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(1613);var d={collection:o.default.array,itemGenerator:o.default.func,columnLabels:o.default.object,tableColumns:o.default.array,columns:o.default.array,onChange:o.default.func,itemRenderers:o.default.object,allowDeletes:o.default.bool,expandFieldset:o.default.node,emptyMessage:o.default.node,extraButtons:o.default.node,allowAddItem:o.default.bool},p={onChange:function(){},itemRenderers:{},columnLabels:{},allowDeletes:!1,emptyMessage:"No entries",allowAddItem:!1,itemGenerator:function(){return{}}};function h(e){var t=e.map((function(e){return Object.assign({},e,{id:e.id||l.default.generate()})})),n={};return t.forEach((function(e){n[e.id]=e})),n}o.default.node;var m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={expandedColumns:{},collection:h(e.collection)},n.renderItem=n.renderItem.bind(n),n.onAddItem=n.onAddItem.bind(n),n.renderExpandableSection=n.renderExpandableSection.bind(n),n.getLabel=n.getLabel.bind(n),n.onFieldsetChange=n.onFieldsetChange.bind(n),n.renderTableBody=n.renderTableBody.bind(n),n.changeCollection=n.changeCollection.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){e.collection!==this.props.collection&&this.setState({collection:h(e.collection)})}},{key:"onCellChange",value:function(e,t,n){this.changeCollection(Object.assign({},this.state.collection,f({},e,Object.assign({},this.state.collection[e],f({},t,n)))))}},{key:"onAddItem",value:function(){var e=this.props.itemGenerator();e.id||(e=Object.assign({},e,{id:l.default.generate()})),this.changeCollection(Object.assign({},this.state.collection,f({},e.id,e)))}},{key:"onFieldsetChange",value:function(e){this.changeCollection(Object.assign({},this.state.collection,f({},e.id,e)))}},{key:"getLabel",value:function(e){var t=this.props.columnLabels,n=t[e]?t[e]:e;return n.startsWith("__")&&(n=""),n}},{key:"changeCollection",value:function(e){this.setState({collection:e}),this.props.onChange(Object.keys(e).map((function(t){return e[t]})))}},{key:"deleteItem",value:function(e){var t=Object.assign({},this.state.collection);delete t[e],this.changeCollection(t)}},{key:"effectiveTableColumns",value:function(){var e=this.props,t=e.tableColumns,n=e.allowDeletes,a=e.expandFieldset,r=n?t.concat(["__actions"]):t;return a?["__expand"].concat(r):r}},{key:"toggleExpand",value:function(e){this.onCellChange(e,"__expanded",!1),this.setState({expandedColumns:Object.assign({},this.state.expandedColumns,f({},e,!this.state.expandedColumns[e]))})}},{key:"renderHeaderRow",value:function(){var e=this,t=this.effectiveTableColumns();return r.default.createElement("thead",null,r.default.createElement("tr",null,this.props.expandFieldset&&r.default.createElement("th",{className:"tiny-cell"}),t.map((function(t){return r.default.createElement("th",{key:t},e.getLabel(t))})),this.props.allowDeletes&&r.default.createElement("th",{className:"tiny-cell"})))}},{key:"renderExpandableSection",value:function(e){var t=this,n=function(){return{item:e,onChange:t.onFieldsetChange}};return(0,s.recurseReactClone)(this.props.expandFieldset,u.default,n)}},{key:"renderCell",value:function(e,t){var n=this.props.itemRenderers[t],a=e[t],r=this.onCellChange.bind(this,e.id,t);return n?n(a,r,this.getLabel(t)):a}},{key:"renderItem",value:function(e){var t=this,n=this.props,a=n.tableColumns,o=n.allowDeletes,l=n.expandFieldset,i=!!this.state.expandedColumns[e.id]||e.__expanded,u=[];l&&u.push(r.default.createElement("td",{key:"__expand",className:"expand"},r.default.createElement("i",{className:"fa fa-caret-"+(i?"down":"right")+" text-primary pointer",onClick:this.toggleExpand.bind(this,e.id)}))),u=u.concat(a.map((function(n){return r.default.createElement("td",{key:n},t.renderCell(e,n))}))),o&&u.push(r.default.createElement("td",{key:"__actions"},r.default.createElement("i",{className:"fa fa-close text-primary pointer",onClick:this.deleteItem.bind(this,e.id)})));var s=[r.default.createElement("tr",{className:"row",key:e.id},u)];return i&&s.push(r.default.createElement("tr",{className:"exp",key:"exp__"+e.id},r.default.createElement("td",{colSpan:this.effectiveTableColumns().length,className:"expanded"},r.default.createElement("div",null,this.renderExpandableSection(e))))),s}},{key:"renderEmptyCell",value:function(){return r.default.createElement("tr",null,r.default.createElement("td",{className:"empty-collection"},this.props.emptyMessage))}},{key:"renderTableBody",value:function(){var e=this,t=Object.keys(this.state.collection).map((function(t){return e.state.collection[t]})),n=t.length?t.map((function(t){return e.renderItem(t)})):this.renderEmptyCell();return r.default.createElement("tbody",null,n)}},{key:"render",value:function(){return r.default.createElement("div",{className:"CRUD"},r.default.createElement("table",{className:"table"},this.renderHeaderRow(),this.renderTableBody()),r.default.createElement("div",null,this.props.allowAddItem&&r.default.createElement(i.default,{bsStyle:"primary",onClick:this.onAddItem},r.default.createElement("i",{className:"fa fa-plus"})," Add Item"),this.props.extraButtons))}}]),t}(r.default.PureComponent);t.default=m,m.defaultProps=p,m.propTypes=d},1612:function(e,t,n){},1613:function(e,t,n){},1614:function(e,t,n){},1648:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=p(n(1)),l=p(n(0)),i=n(11),u=p(n(278)),s=p(n(463)),c=p(n(411)),f=p(n(66)),d=p(n(558));function p(e){return e&&e.__esModule?e:{default:e}}var h="fix",m="metric",y={onChange:l.default.func,value:l.default.object,isFloat:l.default.bool,datasource:l.default.object,default:l.default.shape({type:l.default.oneOf(["fix","metric"]),value:l.default.oneOfType([l.default.string,l.default.number])})},v={onChange:function(){},default:{type:h,value:5}},g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.onChange=n.onChange.bind(n),n.setType=n.setType.bind(n),n.setFixedValue=n.setFixedValue.bind(n),n.setMetric=n.setMetric.bind(n);var a=(e.value?e.value.type:e.default.type)||h,r=(e.value?e.value.value:e.default.value)||"100";return n.state={type:a,fixedValue:a===h?r:"",metricValue:a===m?r:null},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"onChange",value:function(){this.props.onChange({type:this.state.type,value:this.state.type===h?this.state.fixedValue:this.state.metricValue})}},{key:"setType",value:function(e){this.setState({type:e},this.onChange)}},{key:"setFixedValue",value:function(e){this.setState({fixedValue:e},this.onChange)}},{key:"setMetric",value:function(e){this.setState({metricValue:e},this.onChange)}},{key:"renderPopover",value:function(){var e=this,t=(this.props.value||this.props.default).type||h,n=this.props.datasource?this.props.datasource.metrics_combo:null;return o.default.createElement(i.Popover,{id:"filter-popover"},o.default.createElement("div",{style:{width:"240px"}},o.default.createElement(d.default,{title:"Fixed",isSelected:t===h,onSelect:function(){e.onChange(h)}},o.default.createElement(s.default,{isFloat:!0,onChange:this.setFixedValue,onFocus:function(){e.setType(h)},value:this.state.fixedValue})),o.default.createElement(d.default,{title:"Based on a metric",isSelected:t===m,onSelect:function(){e.onChange(m)}},o.default.createElement(c.default,a({},u.default.metric,{name:"metric",choices:n,onFocus:function(){e.setType(m)},onChange:this.setMetric,value:this.state.metricValue})))))}},{key:"render",value:function(){return o.default.createElement("div",null,o.default.createElement(f.default,this.props),o.default.createElement(i.OverlayTrigger,{container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},o.default.createElement(i.Label,{style:{cursor:"pointer"}},this.state.type===h&&o.default.createElement("span",null,this.state.fixedValue),this.state.type===m&&o.default.createElement("span",null,o.default.createElement("span",{style:{fontWeight:"normal"}},"metric: "),o.default.createElement("strong",null,this.state.metricValue)))))}}]),t}(o.default.Component);t.default=g,g.propTypes=y,g.defaultProps=v},1649:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var a=l(n(1)),r=l(n(0)),o=n(11);function l(e){return e&&e.__esModule?e:{default:e}}var i={onChange:r.default.func,value:r.default.oneOfType([r.default.string,r.default.number])},u={onChange:function(){}};function s(e){return a.default.createElement(o.FormControl,{type:"hidden",value:e.value})}s.propTypes=i,s.defaultProps=u},1650:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=f(n(1)),o=f(n(0)),l=n(11),i=f(n(75)),u=f(n(68)),s=f(n(897)),c=f(n(557));function f(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p={onChange:o.default.func},h={onChange:function(){}},m=[{value:"value",label:"Actual value"},{value:"diff",label:"Difference"},{value:"perc",label:"Percentage"},{value:"perc_change",label:"Percentage Change"}],y=[{value:"time",label:"Time Comparison"},{value:"contrib",label:"Contribution"},{value:"spark",label:"Sparkline"},{value:"avg",label:"Period Average"}],v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),a=Object.assign({},e);return delete a.onChange,n.state=a,n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(){this.props.onChange(this.state)}},{key:"onSelectChange",value:function(e,t){this.setState(d({},e,t.value),this.onChange)}},{key:"onTextInputChange",value:function(e,t){this.setState(d({},e,t.target.value),this.onChange)}},{key:"onCheckboxChange",value:function(e,t){this.setState(d({},e,t),this.onChange)}},{key:"onBoundsChange",value:function(e){this.setState({bounds:e},this.onChange)}},{key:"onYAxisBoundsChange",value:function(e){this.setState({yAxisBounds:e},this.onChange)}},{key:"setType",value:function(){}},{key:"textSummary",value:function(){return""+this.state.label}},{key:"edit",value:function(){}},{key:"formRow",value:function(e,t,n,a){return r.default.createElement(l.Row,{style:{marginTop:"5px"}},r.default.createElement(l.Col,{md:5},e+" ",r.default.createElement(u.default,{placement:"top",tooltip:t,label:n})),r.default.createElement(l.Col,{md:7},a))}},{key:"renderPopover",value:function(){return r.default.createElement(l.Popover,{id:"ts-col-popo",title:"Column Configuration"},r.default.createElement("div",{style:{width:300}},this.formRow("Label","The column header label","time-lag",r.default.createElement(l.FormControl,{value:this.state.label,onChange:this.onTextInputChange.bind(this,"label"),bsSize:"small",placeholder:"Label"})),this.formRow("Tooltip","Column header tooltip","col-tooltip",r.default.createElement(l.FormControl,{value:this.state.tooltip,onChange:this.onTextInputChange.bind(this,"tooltip"),bsSize:"small",placeholder:"Tooltip"})),this.formRow("Type","Type of comparison, value difference or percentage","col-type",r.default.createElement(i.default,{value:this.state.colType,clearable:!1,onChange:this.onSelectChange.bind(this,"colType"),options:y})),r.default.createElement("hr",null),"spark"===this.state.colType&&this.formRow("Width","Width of the sparkline","spark-width",r.default.createElement(l.FormControl,{value:this.state.width,onChange:this.onTextInputChange.bind(this,"width"),bsSize:"small",placeholder:"Width"})),"spark"===this.state.colType&&this.formRow("Height","Height of the sparkline","spark-width",r.default.createElement(l.FormControl,{value:this.state.height,onChange:this.onTextInputChange.bind(this,"height"),bsSize:"small",placeholder:"height"})),["time","avg"].indexOf(this.state.colType)>=0&&this.formRow("Time Lag","Number of periods to compare against","time-lag",r.default.createElement(l.FormControl,{value:this.state.timeLag,onChange:this.onTextInputChange.bind(this,"timeLag"),bsSize:"small",placeholder:"Time Lag"})),["spark"].indexOf(this.state.colType)>=0&&this.formRow("Time Ratio","Number of periods to ratio against","time-ratio",r.default.createElement(l.FormControl,{value:this.state.timeRatio,onChange:this.onTextInputChange.bind(this,"timeRatio"),bsSize:"small",placeholder:"Time Lag"})),"time"===this.state.colType&&this.formRow("Type","Type of comparison, value difference or percentage","comp-type",r.default.createElement(i.default,{value:this.state.comparisonType,clearable:!1,onChange:this.onSelectChange.bind(this,"comparisonType"),options:m})),"spark"===this.state.colType&&this.formRow("Show Y-axis","Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise.","show-y-axis-bounds",r.default.createElement(c.default,{value:this.state.showYAxis,onChange:this.onCheckboxChange.bind(this,"showYAxis")})),"spark"===this.state.colType&&this.formRow("Y-axis bounds","Manually set min/max values for the y-axis.","y-axis-bounds",r.default.createElement(s.default,{value:this.state.yAxisBounds,onChange:this.onYAxisBoundsChange.bind(this)})),"spark"!==this.state.colType&&this.formRow("Color bounds","Number bounds used for color encoding from red to blue.\n              Reverse the numbers for blue to red. To get pure red or blue,\n              you can enter either only min or max.","bounds",r.default.createElement(s.default,{value:this.state.bounds,onChange:this.onBoundsChange.bind(this)})),this.formRow("Number format","Optional d3 number format string","d3-format",r.default.createElement(l.FormControl,{value:this.state.d3format,onChange:this.onTextInputChange.bind(this,"d3format"),bsSize:"small",placeholder:"Number format string"})),"spark"===this.state.colType&&this.formRow("Date format","Optional d3 date format string","date-format",r.default.createElement(l.FormControl,{value:this.state.dateFormat,onChange:this.onTextInputChange.bind(this,"dateFormat"),bsSize:"small",placeholder:"Date format string"}))))}},{key:"render",value:function(){return r.default.createElement("span",null,this.textSummary()," ",r.default.createElement(l.OverlayTrigger,{container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},r.default.createElement(u.default,{icon:"edit",className:"text-primary",onClick:this.edit.bind(this),label:"edit-ts-column"})))}}]),t}(r.default.Component);t.default=v,v.propTypes=p,v.defaultProps=h},1651:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=f(n(1)),o=f(n(0)),l=n(11),i=n(1652),u=f(n(463)),s=f(n(66)),c=n(414);function f(e){return e&&e.__esModule?e:{default:e}}var d=["longitude","latitude","zoom","bearing","pitch"],p={onChange:o.default.func.isRequired,value:o.default.shape({longitude:o.default.number,latitude:o.default.number,zoom:o.default.number,bearing:o.default.number,pitch:o.default.number}),default:o.default.object,name:o.default.string.isRequired},h={onChange:function(){},default:{type:"fix",value:5},value:c.defaultViewport},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(e,t){this.props.onChange(Object.assign({},this.props.value,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t)))}},{key:"renderTextControl",value:function(e){return r.default.createElement("div",{key:e},e,r.default.createElement(u.default,{value:this.props.value[e],onChange:this.onChange.bind(this,e),isFloat:!0}))}},{key:"renderPopover",value:function(){var e=this;return r.default.createElement(l.Popover,{id:"filter-popover-"+this.props.name,title:"Viewport"},d.map((function(t){return e.renderTextControl(t)})))}},{key:"renderLabel",value:function(){return this.props.value.longitude&&this.props.value.latitude?(0,i.decimal2sexagesimal)(this.props.value.longitude)+" | "+(0,i.decimal2sexagesimal)(this.props.value.latitude):"N/A"}},{key:"render",value:function(){return r.default.createElement("div",null,r.default.createElement(s.default,this.props),r.default.createElement(l.OverlayTrigger,{container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},r.default.createElement(l.Label,{style:{cursor:"pointer"}},this.renderLabel())))}}]),t}(r.default.Component);t.default=m,m.propTypes=p,m.defaultProps=h},1653:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=c(n(1)),o=c(n(0)),l=n(11),i=c(n(277)),u=c(n(66)),s=n(10);function c(e){return e&&e.__esModule?e:{default:e}}var f={description:o.default.string,label:o.default.string,name:o.default.string.isRequired,onChange:o.default.func,value:o.default.string.isRequired},d={onChange:function(){}},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={showModal:!1,filter:""},n.toggleModal=n.toggleModal.bind(n),n.changeSearch=n.changeSearch.bind(n),n.setSearchRef=n.setSearchRef.bind(n),n.focusSearch=n.focusSearch.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(e){this.props.onChange(e),this.setState({showModal:!1})}},{key:"setSearchRef",value:function(e){this.searchRef=e}},{key:"toggleModal",value:function(){this.setState({showModal:!this.state.showModal})}},{key:"changeSearch",value:function(e){this.setState({filter:e.target.value})}},{key:"focusSearch",value:function(){this.searchRef&&this.searchRef.focus()}},{key:"renderVizType",value:function(e){var t=e;return r.default.createElement("div",{className:"viztype-selector-container "+(t===this.props.value?"selected":""),onClick:this.onChange.bind(this,t)},r.default.createElement("img",{alt:"viz-type-"+t,width:"100%",className:"viztype-selector "+(this.props.value===t?"selected":""),src:"/static/assets/images/viz_thumbnails/"+t+".png"}),r.default.createElement("div",{className:"viztype-label"},i.default[t].label))}},{key:"render",value:function(){for(var e=this,t=this.state.filter,n=Object.keys(i.default).filter((function(e){return 0===t.length||i.default[e].label.toLowerCase().includes(t)})),a=[],o=0;o<=n.length;o+=6)a.push(r.default.createElement(l.Row,{key:"row-"+o},n.slice(o,o+6).map((function(t){return r.default.createElement(l.Col,{md:2,key:"grid-col-"+t},e.renderVizType(t))}))));return r.default.createElement("div",null,r.default.createElement(u.default,this.props),r.default.createElement(l.OverlayTrigger,{placement:"right",overlay:r.default.createElement(l.Tooltip,{id:"error-tooltip"},"Click to change visualization type")},r.default.createElement(l.Label,{onClick:this.toggleModal,style:{cursor:"pointer"}},i.default[this.props.value].label)),r.default.createElement(l.Modal,{show:this.state.showModal,onHide:this.toggleModal,onEnter:this.focusSearch,onExit:this.setSearchRef,bsSize:"lg"},r.default.createElement(l.Modal.Header,{closeButton:!0},r.default.createElement(l.Modal.Title,null,(0,s.t)("Select a visualization type"))),r.default.createElement(l.Modal.Body,null,r.default.createElement("div",null,r.default.createElement(l.FormControl,{id:"formControlsText",inputRef:function(t){e.setSearchRef(t)},type:"text",bsSize:"sm",value:this.state.filter,placeholder:(0,s.t)("Search / Filter"),onChange:this.changeSearch})),a)))}}]),t}(r.default.PureComponent);t.default=p,p.propTypes=f,p.defaultProps=d},1654:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=g(n(1)),o=g(n(0)),l=g(n(274)),i=g(n(66)),u=n(10),s=g(n(400)),c=g(n(401)),f=g(n(1655)),d=g(n(1657)),p=g(n(362)),h=g(n(232)),m=g(n(560)),y=g(n(299)),v=n(300);function g(e){return e&&e.__esModule?e:{default:e}}function b(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var E={name:o.default.string.isRequired,onChange:o.default.func,value:o.default.oneOfType([o.default.arrayOf(o.default.oneOfType([o.default.string,y.default])),o.default.oneOfType([o.default.string,y.default])]),columns:o.default.arrayOf(h.default),savedMetrics:o.default.arrayOf(m.default),multi:o.default.bool,datasourceType:o.default.string},C={onChange:function(){}};function O(e){return e&&!(e instanceof p.default)&&e.expressionType}function _(e){return e?Array.isArray(e)?e.map((function(e){return O(e)?new p.default(e):e})):O(e)?[new p.default(e)]:[e]:[]}var S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n.onMetricEdit=n.onMetricEdit.bind(n),n.checkIfAggregateInInput=n.checkIfAggregateInInput.bind(n),n.optionsForSelect=n.optionsForSelect.bind(n),n.selectFilterOption=n.selectFilterOption.bind(n),n.isAutoGeneratedMetric=n.isAutoGeneratedMetric.bind(n),n.optionRenderer=(0,s.default)((function(e){return r.default.createElement(f.default,{option:e})}),{ignoreAutogeneratedMetrics:!0}),n.valueRenderer=function(e){return r.default.createElement(d.default,{option:e,onMetricEdit:n.onMetricEdit,columns:n.props.columns,multi:n.props.multi,datasourceType:n.props.datasourceType})},n.refFunc=function(e){e&&(n.select=e._selectRef)},n.state={aggregateInInput:null,options:n.optionsForSelect(n.props),value:_(n.props.value)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){this.props.columns===e.columns&&this.props.savedMetrics===e.savedMetrics||(this.setState({options:this.optionsForSelect(e)}),this.props.onChange([])),this.props.value!==e.value&&this.setState({value:_(e.value)})}},{key:"onMetricEdit",value:function(e){var t=this.state.value.map((function(t){return t.optionName===e.optionName?e:t}));this.props.multi||(t=t[0]),this.props.onChange(t)}},{key:"onChange",value:function(e){var t=this;if(null!==e){var n=e;this.props.multi||(n=[e].filter((function(e){return e})));var a=n.map((function(e){if(e.metric_name)return e.metric_name;if(e.column_name){var n=t.clearedAggregateInInput;return t.clearedAggregateInInput=null,new p.default({column:e,aggregate:n||(r=e,o=r.type,"string"!=typeof o?v.AGGREGATES.COUNT:""===o||"expression"===o?v.AGGREGATES.SUM:o.match(/.*char.*/i)||o.match(/string.*/i)||o.match(/.*text.*/i)?v.AGGREGATES.COUNT_DISTINCT:o.match(/.*int.*/i)||"LONG"===o||"DOUBLE"===o||"FLOAT"===o?v.AGGREGATES.SUM:o.match(/.*bool.*/i)?v.AGGREGATES.MAX:o.match(/.*time.*/i)?v.AGGREGATES.COUNT:o.match(/unknown/i)?v.AGGREGATES.COUNT:null)})}if(e instanceof p.default)return e;if(e.aggregate_name){var a=e.aggregate_name+"()";return t.select.setInputValue(a),t.select.handleInputChange({target:{value:a}}),setTimeout((function(){t.select.input.input.selectionStart=a.length-1,t.select.input.input.selectionEnd=a.length-1}),0),null}var r,o;return null})).filter((function(e){return e}));this.props.multi||(a=a[0]),this.props.onChange(a)}else this.props.onChange(null)}},{key:"checkIfAggregateInInput",value:function(e){var t={aggregateInInput:null};Object.keys(v.AGGREGATES).forEach((function(n){e.toLowerCase().startsWith(n.toLowerCase()+"(")&&(t={aggregateInInput:n})})),this.clearedAggregateInInput=this.state.aggregateInInput,this.setState(t)}},{key:"optionsForSelect",value:function(e){return[].concat(b(e.columns),b(Object.keys(v.AGGREGATES).map((function(e){return{aggregate_name:e}}))),b(e.savedMetrics)).reduce((function(e,t){return t.metric_name?e.push(Object.assign({},t,{optionName:t.metric_name})):t.column_name?e.push(Object.assign({},t,{optionName:"_col_"+t.column_name})):t.aggregate_name&&e.push(Object.assign({},t,{optionName:"_aggregate_"+t.aggregate_name})),e}),[])}},{key:"isAutoGeneratedMetric",value:function(e){return"druid"===this.props.datasourceType?v.druidAutoGeneratedMetricRegex.test(e.verbose_name):v.sqlaAutoGeneratedMetricNameRegex.test(e.metric_name)}},{key:"selectFilterOption",value:function(e,t){if(this.state.aggregateInInput){var n=t.length;t.endsWith(")")&&(n=t.length-1);var a=t.substring(t.indexOf("(")+1,n);return e.column_name&&e.column_name.toLowerCase().indexOf(a)>=0}return e.optionName&&(!e.metric_name||!this.isAutoGeneratedMetric(e)||e.verbose_name)&&(e.optionName.toLowerCase().indexOf(t)>=0||e.verbose_name&&e.verbose_name.toLowerCase().indexOf(t)>=0)}},{key:"render",value:function(){return r.default.createElement("div",{className:"metrics-select"},r.default.createElement(i.default,this.props),r.default.createElement(c.default,{multi:this.props.multi,name:"select-"+this.props.name,placeholder:(0,u.t)("choose a column or aggregate function"),options:this.state.options,value:this.props.multi?this.state.value:this.state.value[0],labelKey:"label",valueKey:"optionName",clearable:!0,closeOnSelect:!0,onChange:this.onChange,optionRenderer:this.optionRenderer,valueRenderer:this.valueRenderer,onInputChange:this.checkIfAggregateInInput,filterOption:this.selectFilterOption,refFunc:this.refFunc,selectWrap:l.default}))}}]),t}(r.default.PureComponent);t.default=S,S.propTypes=E,S.defaultProps=C},1655:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(1)),r=d(n(0)),o=d(n(612)),l=d(n(302)),i=d(n(1656)),u=d(n(232)),s=d(n(560)),c=d(n(913)),f=d(n(329));function d(e){return e&&e.__esModule?e:{default:e}}var p={option:r.default.oneOfType([u.default,s.default,c.default]).isRequired,addWarningToast:r.default.func.isRequired};function h(e){var t=e.option,n=e.addWarningToast;return t.metric_name?a.default.createElement(o.default,{metric:t,showType:!0}):t.column_name?a.default.createElement(l.default,{column:t,showType:!0}):t.aggregate_name?a.default.createElement(i.default,{aggregate:t,showType:!0}):(n("You must supply either a saved metric, column or aggregate to MetricDefinitionOption"),null)}h.propTypes=p,t.default=(0,f.default)(h)},1656:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var a=l(n(1)),r=l(n(0)),o=l(n(301));function l(e){return e&&e.__esModule?e:{default:e}}var i={aggregate:l(n(913)).default,showType:r.default.bool};function u(e){var t=e.aggregate,n=e.showType;return a.default.createElement("div",null,n&&a.default.createElement(o.default,{type:"aggregate"}),a.default.createElement("span",{className:"m-r-5 option-label"},t.aggregate_name))}u.propTypes=i},1657:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=p;var a=f(n(1)),r=f(n(0)),o=f(n(1658)),l=f(n(362)),i=f(n(232)),u=f(n(612)),s=f(n(560)),c=f(n(299));function f(e){return e&&e.__esModule?e:{default:e}}var d={option:r.default.oneOfType([s.default,c.default]).isRequired,onMetricEdit:r.default.func,columns:r.default.arrayOf(i.default),multi:r.default.bool,datasourceType:r.default.string};function p(e){var t=e.option,n=e.onMetricEdit,r=e.columns,i=e.multi,s=e.datasourceType;return t.metric_name?a.default.createElement(u.default,{metric:t}):t instanceof l.default?a.default.createElement(o.default,{adhocMetric:t,onMetricEdit:n,columns:r,multi:i,datasourceType:s}):null}p.propTypes=d},1658:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=c(n(1)),o=c(n(0)),l=n(11),i=c(n(1659)),u=c(n(362)),s=c(n(232));function c(e){return e&&e.__esModule?e:{default:e}}var f={adhocMetric:o.default.instanceOf(u.default),onMetricEdit:o.default.func.isRequired,columns:o.default.arrayOf(s.default),multi:o.default.bool,datasourceType:o.default.string},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeMetricEditOverlay=n.closeMetricEditOverlay.bind(n),n.onOverlayEntered=n.onOverlayEntered.bind(n),n.onOverlayExited=n.onOverlayExited.bind(n),n.onPopoverResize=n.onPopoverResize.bind(n),n.state={overlayShown:!n.props.adhocMetric.fromFormData},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onPopoverResize",value:function(){this.forceUpdate()}},{key:"onOverlayEntered",value:function(){this.setState({overlayShown:!0})}},{key:"onOverlayExited",value:function(){this.setState({overlayShown:!1})}},{key:"closeMetricEditOverlay",value:function(){this.refs.overlay.hide()}},{key:"render",value:function(){var e=this.props.adhocMetric,t=r.default.createElement(i.default,{onResize:this.onPopoverResize,adhocMetric:e,onChange:this.props.onMetricEdit,onClose:this.closeMetricEditOverlay,columns:this.props.columns,datasourceType:this.props.datasourceType});return r.default.createElement(l.OverlayTrigger,{ref:"overlay",placement:"right",trigger:"click",disabled:!0,overlay:t,rootClose:!0,shouldUpdatePosition:!0,defaultOverlayShown:!e.fromFormData,onEntered:this.onOverlayEntered,onExited:this.onOverlayExited},r.default.createElement(l.Label,{style:{margin:this.props.multi?0:3,cursor:"pointer"}},r.default.createElement("div",{onMouseDownCapture:function(e){e.stopPropagation()}},r.default.createElement("span",{className:"m-r-5 option-label"},e.label,r.default.createElement("i",{className:"glyphicon glyphicon-triangle-"+(this.state.overlayShown?"left":"right")+" adhoc-label-arrow"})))))}}]),t}(r.default.PureComponent);t.default=d,d.propTypes=f},1659:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=E(n(1)),l=E(n(0)),i=n(11),u=E(n(274)),s=E(n(275));n(363),n(364),n(467);var c=n(300),f=n(10),d=E(n(400)),p=E(n(401)),h=E(n(1660)),m=E(n(232)),y=n(362),v=E(y),g=E(n(302)),b=n(562);function E(e){return e&&e.__esModule?e:{default:e}}var C=ace.acequire("ace/ext/language_tools"),O={adhocMetric:l.default.instanceOf(v.default).isRequired,onChange:l.default.func.isRequired,onClose:l.default.func.isRequired,onResize:l.default.func.isRequired,columns:l.default.arrayOf(m.default),datasourceType:l.default.string},_=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(n.onSave=n.onSave.bind(n),n.onColumnChange=n.onColumnChange.bind(n),n.onAggregateChange=n.onAggregateChange.bind(n),n.onSqlExpressionChange=n.onSqlExpressionChange.bind(n),n.onLabelChange=n.onLabelChange.bind(n),n.onDragDown=n.onDragDown.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n.handleAceEditorRef=n.handleAceEditorRef.bind(n),n.refreshAceEditor=n.refreshAceEditor.bind(n),n.state={adhocMetric:n.props.adhocMetric,width:300,height:180},n.selectProps={multi:!1,name:"select-column",labelKey:"label",autosize:!1,clearable:!0,selectWrap:u.default},C){var a=b.sqlWords.concat(n.props.columns.map((function(e){return{name:e.column_name,value:e.column_name,score:50,meta:"column"}}))),r={getCompletions:function(e,t,n,r,o){o(null,a)}};C.setCompleters([r])}return document.addEventListener("mouseup",n.onMouseUp),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillUnmount",value:function(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}},{key:"onSave",value:function(){this.props.onChange(this.state.adhocMetric),this.props.onClose()}},{key:"onColumnChange",value:function(e){this.setState({adhocMetric:this.state.adhocMetric.duplicateWith({column:e,expressionType:y.EXPRESSION_TYPES.SIMPLE})})}},{key:"onAggregateChange",value:function(e){this.setState({adhocMetric:this.state.adhocMetric.duplicateWith({aggregate:e&&e.aggregate,expressionType:y.EXPRESSION_TYPES.SIMPLE})})}},{key:"onSqlExpressionChange",value:function(e){this.setState({adhocMetric:this.state.adhocMetric.duplicateWith({sqlExpression:e,expressionType:y.EXPRESSION_TYPES.SQL})})}},{key:"onLabelChange",value:function(e){this.setState({adhocMetric:this.state.adhocMetric.duplicateWith({label:e.target.value,hasCustomLabel:!0})})}},{key:"onDragDown",value:function(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}},{key:"onMouseMove",value:function(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),300),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),180)})}},{key:"onMouseUp",value:function(){document.removeEventListener("mousemove",this.onMouseMove)}},{key:"handleAceEditorRef",value:function(e){e&&(this.aceEditorRef=e)}},{key:"refreshAceEditor",value:function(){var e=this;setTimeout((function(){return e.aceEditorRef.editor.resize()}),0)}},{key:"render",value:function(){var e=this.props,t=e.adhocMetric,n=e.columns,r=(e.onChange,e.onClose,e.onResize,e.datasourceType,function(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}(e,["adhocMetric","columns","onChange","onClose","onResize","datasourceType"])),l=this.state.adhocMetric,u={placeholder:(0,f.t)("%s column(s)",n.length),options:n,value:l.column&&l.column.column_name||l.inferSqlExpressionColumn(),onChange:this.onColumnChange,optionRenderer:(0,d.default)((function(e){return o.default.createElement(g.default,{column:e,showType:!0})})),valueRenderer:function(e){return e.column_name},valueKey:"column_name"},m={placeholder:(0,f.t)("%s aggregates(s)",Object.keys(c.AGGREGATES).length),options:Object.keys(c.AGGREGATES).map((function(e){return{aggregate:e}})),value:l.aggregate||l.inferSqlExpressionAggregate(),onChange:this.onAggregateChange,optionRenderer:(0,d.default)((function(e){return e.aggregate})),valueRenderer:function(e){return e.aggregate},valueKey:"aggregate"};"druid"===this.props.datasourceType&&(m.options=m.options.filter((function(e){return"AVG"!==e.aggregate})));var v=o.default.createElement(h.default,{adhocMetric:l,onChange:this.onLabelChange}),b=l.isValid(),E=!l.equals(t);return o.default.createElement(i.Popover,a({id:"metrics-edit-popover",title:v},r),o.default.createElement(i.Tabs,{id:"adhoc-metric-edit-tabs",defaultActiveKey:l.expressionType,className:"adhoc-metric-edit-tabs",style:{height:this.state.height,width:this.state.width},onSelect:this.refreshAceEditor,animation:!1},o.default.createElement(i.Tab,{className:"adhoc-metric-edit-tab",eventKey:y.EXPRESSION_TYPES.SIMPLE,title:"Simple"},o.default.createElement(i.FormGroup,null,o.default.createElement(i.ControlLabel,null,o.default.createElement("strong",null,"column")),o.default.createElement(p.default,a({},this.selectProps,u))),o.default.createElement(i.FormGroup,null,o.default.createElement(i.ControlLabel,null,o.default.createElement("strong",null,"aggregate")),o.default.createElement(p.default,a({},this.selectProps,m)))),o.default.createElement(i.Tab,{className:"adhoc-metric-edit-tab",eventKey:y.EXPRESSION_TYPES.SQL,title:"Custom SQL"},"druid"!==this.props.datasourceType?o.default.createElement(i.FormGroup,null,o.default.createElement(s.default,{ref:this.handleAceEditorRef,mode:"sql",theme:"github",height:this.state.height-43+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:l.sqlExpression||l.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"adhoc-filter-sql-editor",wrapEnabled:!0})):o.default.createElement("div",{className:"custom-sql-disabled-message"},"Custom SQL Metrics are not available on druid datasources"))),o.default.createElement("div",null,o.default.createElement(i.Button,{disabled:!b,bsStyle:E&&b?"primary":"default",bsSize:"small",className:"m-r-5",onClick:this.onSave},"Save"),o.default.createElement(i.Button,{bsSize:"small",onClick:this.props.onClose},"Close"),o.default.createElement("i",{onMouseDown:this.onDragDown,className:"glyphicon glyphicon-resize-full edit-popover-resize"})))}}]),t}(o.default.Component);t.default=_,_.propTypes=O,_.defaultProps={columns:[]}},1660:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=u(n(1)),o=u(n(0)),l=n(11),i=u(n(362));function u(e){return e&&e.__esModule?e:{default:e}}var s={adhocMetric:o.default.instanceOf(i.default),onChange:o.default.func.isRequired},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onMouseOver=n.onMouseOver.bind(n),n.onMouseOut=n.onMouseOut.bind(n),n.onClick=n.onClick.bind(n),n.onBlur=n.onBlur.bind(n),n.state={isHovered:!1,isEditable:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onMouseOver",value:function(){this.setState({isHovered:!0})}},{key:"onMouseOut",value:function(){this.setState({isHovered:!1})}},{key:"onClick",value:function(){this.setState({isEditable:!0})}},{key:"onBlur",value:function(){this.setState({isEditable:!1})}},{key:"refFunc",value:function(e){e&&e.focus()}},{key:"render",value:function(){var e=this.props,t=e.adhocMetric,n=e.onChange,a=r.default.createElement(l.Tooltip,{id:"edit-metric-label-tooltip"},"Click to edit label");return r.default.createElement(l.OverlayTrigger,{placement:"top",overlay:a,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut,onClick:this.onClick,onBlur:this.onBlur},this.state.isEditable?r.default.createElement(l.FormControl,{className:"metric-edit-popover-label-input",type:"text",placeholder:t.label,value:t.hasCustomLabel?t.label:"",onChange:n,inputRef:this.refFunc}):r.default.createElement("span",null,t.hasCustomLabel?t.label:"My Metric"," ",r.default.createElement("i",{className:"fa fa-pencil",style:{color:this.state.isHovered?"black":"grey"}})))}}]),t}(r.default.Component);t.default=c,c.propTypes=s},1661:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=C(n(1)),o=C(n(0)),l=C(n(274)),i=n(10),u=C(n(66)),s=C(n(1662)),c=C(n(299)),f=C(n(560)),d=C(n(232)),p=n(412),h=C(p),m=C(n(362)),y=n(300),v=C(n(400)),g=C(n(401)),b=C(n(1663)),E=C(n(914));function C(e){return e&&e.__esModule?e:{default:e}}function O(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _={name:o.default.string,onChange:o.default.func,value:o.default.arrayOf(s.default),datasource:o.default.object,columns:o.default.arrayOf(d.default),savedMetrics:o.default.arrayOf(f.default),formData:o.default.shape({metric:o.default.oneOfType([o.default.string,c.default]),metrics:o.default.arrayOf(o.default.oneOfType([o.default.string,c.default]))})},S={name:"",onChange:function(){},columns:[],savedMetrics:[],formData:{}};function T(e){return e&&!(e instanceof h.default)&&e.expressionType}var w=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.optionsForSelect=n.optionsForSelect.bind(n),n.onFilterEdit=n.onFilterEdit.bind(n),n.onChange=n.onChange.bind(n),n.getMetricExpression=n.getMetricExpression.bind(n);var a=(n.props.value||[]).map((function(e){return T(e)?new h.default(e):e}));return n.optionRenderer=(0,v.default)((function(e){return r.default.createElement(E.default,{option:e})})),n.valueRenderer=function(e){return r.default.createElement(b.default,{adhocFilter:e,onFilterEdit:n.onFilterEdit,options:n.state.options,datasource:n.props.datasource})},n.state={values:a,options:n.optionsForSelect(n.props)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){this.props.columns===e.columns&&this.props.formData===e.formData||this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map((function(e){return T(e)?new h.default(e):e}))})}},{key:"onFilterEdit",value:function(e){this.props.onChange(this.state.values.map((function(t){return t.filterOptionName===e.filterOptionName?e:t})))}},{key:"onChange",value:function(e){var t=this;this.props.onChange(e.map((function(e){return e.saved_metric_name?new h.default({expressionType:"druid"===t.props.datasource.type?p.EXPRESSION_TYPES.SIMPLE:p.EXPRESSION_TYPES.SQL,subject:"druid"===t.props.datasource.type?e.saved_metric_name:t.getMetricExpression(e.saved_metric_name),operator:y.OPERATORS[">"],comparator:0,clause:p.CLAUSES.HAVING}):e.label?new h.default({expressionType:"druid"===t.props.datasource.type?p.EXPRESSION_TYPES.SIMPLE:p.EXPRESSION_TYPES.SQL,subject:"druid"===t.props.datasource.type?e.label:new m.default(e).translateToSql(),operator:y.OPERATORS[">"],comparator:0,clause:p.CLAUSES.HAVING}):e.column_name?new h.default({expressionType:p.EXPRESSION_TYPES.SIMPLE,subject:e.column_name,operator:y.OPERATORS["=="],comparator:"",clause:p.CLAUSES.WHERE}):e instanceof h.default?e:null})).filter((function(e){return e})))}},{key:"getMetricExpression",value:function(e){return this.props.savedMetrics.find((function(t){return t.metric_name===e})).expression}},{key:"optionsForSelect",value:function(e){return[].concat(O(e.columns),O([].concat(O(e.formData.metrics||[]),[e.formData.metric]).map((function(e){return e&&("string"==typeof e?{saved_metric_name:e}:new m.default(e))})))).filter((function(e){return e})).reduce((function(e,t){return t.saved_metric_name?e.push(Object.assign({},t,{filterOptionName:t.saved_metric_name})):t.column_name?e.push(Object.assign({},t,{filterOptionName:"_col_"+t.column_name})):t instanceof m.default&&e.push(Object.assign({},t,{filterOptionName:"_adhocmetric_"+t.label})),e}),[]).sort((function(e,t){return(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)}))}},{key:"render",value:function(){return r.default.createElement("div",{className:"metrics-select"},r.default.createElement(u.default,this.props),r.default.createElement(g.default,{multi:!0,name:"select-"+this.props.name,placeholder:(0,i.t)("choose a column or metric"),options:this.state.options,value:this.state.values,labelKey:"label",valueKey:"filterOptionName",clearable:!0,closeOnSelect:!0,onChange:this.onChange,optionRenderer:this.optionRenderer,valueRenderer:this.valueRenderer,selectWrap:l.default}))}}]),t}(r.default.Component);t.default=w,w.propTypes=_,w.defaultProps=S},1662:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(0),o=(a=r)&&a.__esModule?a:{default:a},l=n(300),i=n(412);t.default=o.default.oneOfType([o.default.shape({expressionType:o.default.oneOf([i.EXPRESSION_TYPES.SIMPLE]).isRequired,clause:o.default.oneOf([i.CLAUSES.HAVING,i.CLAUSES.WHERE]).isRequired,subject:o.default.string.isRequired,operator:o.default.oneOf(Object.keys(l.OPERATORS)).isRequired,comparator:o.default.oneOfType([o.default.string,o.default.arrayOf(o.default.string)]).isRequired}),o.default.shape({expressionType:o.default.oneOf([i.EXPRESSION_TYPES.SQL]).isRequired,clause:o.default.oneOf([i.CLAUSES.WHERE,i.CLAUSES.HAVING]).isRequired,sqlExpression:o.default.string.isRequired})])},1663:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=f(n(1)),o=f(n(0)),l=n(11),i=f(n(1664)),u=f(n(412)),s=f(n(232)),c=f(n(299));function f(e){return e&&e.__esModule?e:{default:e}}var d={adhocFilter:o.default.instanceOf(u.default).isRequired,onFilterEdit:o.default.func.isRequired,options:o.default.arrayOf(o.default.oneOfType([s.default,o.default.shape({saved_metric_name:o.default.string.isRequired}),c.default])).isRequired,datasource:o.default.object},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.closeFilterEditOverlay=n.closeFilterEditOverlay.bind(n),n.onPopoverResize=n.onPopoverResize.bind(n),n.onOverlayEntered=n.onOverlayEntered.bind(n),n.onOverlayExited=n.onOverlayExited.bind(n),n.state={overlayShown:!n.props.adhocFilter.fromFormData},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onPopoverResize",value:function(){this.forceUpdate()}},{key:"onOverlayEntered",value:function(){this.setState({overlayShown:!0})}},{key:"onOverlayExited",value:function(){this.setState({overlayShown:!1})}},{key:"onMouseDown",value:function(e){e.stopPropagation()}},{key:"closeFilterEditOverlay",value:function(){this.refs.overlay.hide()}},{key:"render",value:function(){var e=this.props.adhocFilter,t=r.default.createElement(i.default,{onResize:this.onPopoverResize,adhocFilter:e,onChange:this.props.onFilterEdit,onClose:this.closeFilterEditOverlay,options:this.props.options,datasource:this.props.datasource});return r.default.createElement(l.OverlayTrigger,{ref:"overlay",placement:"right",trigger:"click",disabled:!0,overlay:t,rootClose:!0,shouldUpdatePosition:!0,defaultOverlayShown:!e.fromFormData,onEntered:this.onOverlayEntered,onExited:this.onOverlayExited},r.default.createElement(l.Label,{className:"adhoc-filter-option"},r.default.createElement("div",{onMouseDownCapture:this.onMouseDown},r.default.createElement("span",{className:"m-r-5 option-label"},e.getDefaultLabel(),r.default.createElement("i",{className:"glyphicon glyphicon-triangle-"+(this.state.overlayShown?"left":"right")+" adhoc-label-arrow"})))))}}]),t}(r.default.PureComponent);t.default=p,p.propTypes=d},1664:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=h(n(1)),l=h(n(0)),i=n(11),u=h(n(232)),s=h(n(299)),c=n(412),f=h(c),d=h(n(1665)),p=h(n(1667));function h(e){return e&&e.__esModule?e:{default:e}}var m={adhocFilter:l.default.instanceOf(f.default).isRequired,onChange:l.default.func.isRequired,onClose:l.default.func.isRequired,onResize:l.default.func.isRequired,options:l.default.arrayOf(l.default.oneOfType([u.default,l.default.shape({saved_metric_name:l.default.string.isRequired}),s.default])).isRequired,datasource:l.default.object},y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onSave=n.onSave.bind(n),n.onDragDown=n.onDragDown.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n.onAdhocFilterChange=n.onAdhocFilterChange.bind(n),n.adjustHeight=n.adjustHeight.bind(n),n.state={adhocFilter:n.props.adhocFilter,width:300,height:190},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidMount",value:function(){document.addEventListener("mouseup",this.onMouseUp)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}},{key:"onAdhocFilterChange",value:function(e){this.setState({adhocFilter:e})}},{key:"onSave",value:function(){this.props.onChange(this.state.adhocFilter),this.props.onClose()}},{key:"onDragDown",value:function(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}},{key:"onMouseMove",value:function(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),300),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),190)})}},{key:"onMouseUp",value:function(){document.removeEventListener("mousemove",this.onMouseMove)}},{key:"adjustHeight",value:function(e){this.setState((function(t){return{height:t.height+e}}))}},{key:"render",value:function(){var e=this.props,t=e.adhocFilter,n=(e.options,e.onChange,e.onClose,e.onResize,e.datasource,function(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}(e,["adhocFilter","options","onChange","onClose","onResize","datasource"])),r=this.state.adhocFilter,l=r.isValid(),u=!r.equals(t);return o.default.createElement(i.Popover,a({id:"filter-edit-popover"},n),o.default.createElement(i.Tabs,{id:"adhoc-filter-edit-tabs",defaultActiveKey:r.expressionType,className:"adhoc-filter-edit-tabs",style:{height:this.state.height,width:this.state.width}},o.default.createElement(i.Tab,{className:"adhoc-filter-edit-tab",eventKey:c.EXPRESSION_TYPES.SIMPLE,title:"Simple"},o.default.createElement(d.default,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,datasource:this.props.datasource,onHeightChange:this.adjustHeight})),o.default.createElement(i.Tab,{className:"adhoc-filter-edit-tab",eventKey:c.EXPRESSION_TYPES.SQL,title:"Custom SQL"},this.props.datasource&&"druid"===this.props.datasource.type?o.default.createElement("div",{className:"custom-sql-disabled-message"},"Custom SQL Filters are not available on druid datasources"):o.default.createElement(p.default,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height}))),o.default.createElement("div",null,o.default.createElement(i.Button,{disabled:!l,bsStyle:u&&l?"primary":"default",bsSize:"small",className:"m-r-5",onClick:this.onSave},"Save"),o.default.createElement(i.Button,{bsSize:"small",onClick:this.props.onClose},"Close"),o.default.createElement("i",{onMouseDown:this.onDragDown,className:"glyphicon glyphicon-resize-full edit-popover-resize"})))}}]),t}(o.default.Component);t.default=y,y.propTypes=m},1665:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=b(n(1)),l=b(n(0)),i=n(11),u=b(n(274)),s=n(412),c=b(s),f=b(n(299)),d=b(n(232)),p=n(10),h=n(300),m=b(n(914)),y=b(n(401)),v=b(n(411)),g=b(n(400));function b(e){return e&&e.__esModule?e:{default:e}}var E=n(21),C={adhocFilter:l.default.instanceOf(c.default).isRequired,onChange:l.default.func.isRequired,options:l.default.arrayOf(l.default.oneOfType([d.default,l.default.shape({saved_metric_name:l.default.string.isRequired}),f.default])).isRequired,onHeightChange:l.default.func.isRequired,datasource:l.default.object};function O(e){return e===h.OPERATORS["=="]?"equals":e===h.OPERATORS["!="]?"not equal to":e===h.OPERATORS.LIKE?"like":e}var _=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onSubjectChange=n.onSubjectChange.bind(n),n.onOperatorChange=n.onOperatorChange.bind(n),n.onComparatorChange=n.onComparatorChange.bind(n),n.onInputComparatorChange=n.onInputComparatorChange.bind(n),n.isOperatorRelevant=n.isOperatorRelevant.bind(n),n.refreshComparatorSuggestions=n.refreshComparatorSuggestions.bind(n),n.multiComparatorRef=n.multiComparatorRef.bind(n),n.state={suggestions:[],multiComparatorHeight:30},n.selectProps={multi:!1,name:"select-column",labelKey:"label",autosize:!1,clearable:!1,selectWrap:u.default},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillMount",value:function(){this.refreshComparatorSuggestions()}},{key:"componentDidMount",value:function(){this.handleMultiComparatorInputHeightChange()}},{key:"componentDidUpdate",value:function(e){e.adhocFilter.subject!==this.props.adhocFilter.subject&&this.refreshComparatorSuggestions(),this.handleMultiComparatorInputHeightChange()}},{key:"onSubjectChange",value:function(e){var t=void 0,n=void 0;e&&e.column_name?(t=e.column_name,n=s.CLAUSES.WHERE):e&&(e.saved_metric_name||e.label)&&(t=e.saved_metric_name||e.label,n=s.CLAUSES.HAVING),this.props.onChange(this.props.adhocFilter.duplicateWith({subject:t,clause:n,expressionType:s.EXPRESSION_TYPES.SIMPLE}))}},{key:"onOperatorChange",value:function(e){var t=this.props.adhocFilter.comparator,n=void 0;n=h.MULTI_OPERATORS.indexOf(e.operator)>=0?Array.isArray(t)?t:[t].filter((function(e){return e})):Array.isArray(t)?t[0]:t,this.props.onChange(this.props.adhocFilter.duplicateWith({operator:e&&e.operator,comparator:n,expressionType:s.EXPRESSION_TYPES.SIMPLE}))}},{key:"onInputComparatorChange",value:function(e){this.onComparatorChange(e.target.value)}},{key:"onComparatorChange",value:function(e){this.props.onChange(this.props.adhocFilter.duplicateWith({comparator:e,expressionType:s.EXPRESSION_TYPES.SIMPLE}))}},{key:"handleMultiComparatorInputHeightChange",value:function(){if(this.multiComparatorComponent){var e=this.multiComparatorComponent._selectRef&&this.multiComparatorComponent._selectRef.select&&this.multiComparatorComponent._selectRef.select.control;e&&e.clientHeight!==this.state.multiComparatorHeight&&(this.props.onHeightChange(e.clientHeight-this.state.multiComparatorHeight),this.setState({multiComparatorHeight:e.clientHeight}))}}},{key:"refreshComparatorSuggestions",value:function(){var e=this,t=this.props.datasource,n=this.props.adhocFilter.subject,a=this.props.adhocFilter.clause===s.CLAUSES.HAVING;n&&t&&t.filter_select&&!a&&(this.state.activeRequest&&this.state.activeRequest.abort(),this.setState({activeRequest:E.ajax({type:"GET",url:"/superset/filter/"+t.type+"/"+t.id+"/"+n+"/",success:function(t){return e.setState({suggestions:t,activeRequest:null})}})}))}},{key:"isOperatorRelevant",value:function(e){return!("druid"===this.props.datasource.type&&h.TABLE_ONLY_OPERATORS.indexOf(e)>=0||"table"===this.props.datasource.type&&h.DRUID_ONLY_OPERATORS.indexOf(e)>=0||this.props.adhocFilter.clause===s.CLAUSES.HAVING&&-1===h.HAVING_OPERATORS.indexOf(e))}},{key:"focusComparator",value:function(e){e&&e.focus()}},{key:"multiComparatorRef",value:function(e){e&&(this.multiComparatorComponent=e)}},{key:"render",value:function(){var e=this.props,t=e.adhocFilter,n=e.options,r=e.datasource,l={value:t.subject?{value:t.subject}:void 0,onChange:this.onSubjectChange,optionRenderer:(0,g.default)((function(e){return o.default.createElement(m.default,{option:e})})),valueRenderer:function(e){return o.default.createElement("span",null,e.value)},valueKey:"filterOptionName",noResultsText:(0,p.t)("No such column found. To filter on a metric, try the Custom SQL tab.")};l="druid"===r.type?Object.assign({},l,{placeholder:(0,p.t)("%s column(s) and metric(s)",n.length),options:n}):Object.assign({},l,{placeholder:t.clause===s.CLAUSES.WHERE?(0,p.t)("%s column(s)",n.length):(0,p.t)("To filter on a metric, use Custom SQL tab."),options:n.filter((function(e){return e.column_name}))});var u={placeholder:(0,p.t)("%s operators(s)",Object.keys(h.OPERATORS).length),options:Object.keys(h.OPERATORS).filter(this.isOperatorRelevant).map((function(e){return{operator:e}})),value:t.operator,onChange:this.onOperatorChange,optionRenderer:(0,g.default)((function(e){return O(e.operator)})),valueRenderer:function(e){return o.default.createElement("span",null,O(e.operator))},valueKey:"operator"};return o.default.createElement("span",null,o.default.createElement(i.FormGroup,{className:"adhoc-filter-simple-column-dropdown"},o.default.createElement(y.default,a({},this.selectProps,l))),o.default.createElement(i.FormGroup,null,o.default.createElement(y.default,a({},this.selectProps,u))),o.default.createElement(i.FormGroup,null,h.MULTI_OPERATORS.indexOf(t.operator)>=0||this.state.suggestions.length>0?o.default.createElement(v.default,{multi:h.MULTI_OPERATORS.indexOf(t.operator)>=0,freeForm:!0,name:"filter-comparator-value",value:t.comparator,isLoading:!1,choices:this.state.suggestions,onChange:this.onComparatorChange,showHeader:!1,noResultsText:(0,p.t)("type a value here"),refFunc:this.multiComparatorRef,disabled:"IS NOT NULL"===t.operator||"IS NULL"===t.operator}):o.default.createElement("input",{ref:this.focusComparator,type:"text",onChange:this.onInputComparatorChange,value:t.comparator||"",className:"form-control input-sm",placeholder:(0,p.t)("Filter value")})))}}]),t}(o.default.Component);t.default=_,_.propTypes=C,_.defaultProps={datasource:{}}},1666:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var a=l(n(1)),r=l(n(0)),o=l(n(301));function l(e){return e&&e.__esModule?e:{default:e}}var i={adhocMetric:l(n(299)).default,showType:r.default.bool};function u(e){var t=e.adhocMetric,n=e.showType;return a.default.createElement("div",null,n&&a.default.createElement(o.default,{type:"expression"}),a.default.createElement("span",{className:"m-r-5 option-label"},t.label))}u.propTypes=i},1667:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=g(n(1)),l=g(n(0)),i=g(n(275));n(363),n(364),n(467);var u=n(11),s=g(n(274)),c=n(562),f=n(412),d=g(f),p=g(n(299)),h=g(n(232)),m=g(n(401)),y=g(n(400)),v=n(10);function g(e){return e&&e.__esModule?e:{default:e}}var b={adhocFilter:l.default.instanceOf(d.default).isRequired,onChange:l.default.func.isRequired,options:l.default.arrayOf(l.default.oneOfType([h.default,l.default.shape({saved_metric_name:l.default.string.isRequired}),p.default])).isRequired,height:l.default.number.isRequired},E=ace.acequire("ace/ext/language_tools"),C=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(n.onSqlExpressionChange=n.onSqlExpressionChange.bind(n),n.onSqlExpressionClauseChange=n.onSqlExpressionClauseChange.bind(n),n.handleAceEditorRef=n.handleAceEditorRef.bind(n),n.selectProps={multi:!1,name:"select-column",labelKey:"label",autosize:!1,clearable:!1,selectWrap:s.default},E){var a=c.sqlWords.concat(n.props.options.map((function(e){return e.column_name?{name:e.column_name,value:e.column_name,score:50,meta:"option"}:null}))),r={getCompletions:function(e,t,n,r,o){o(null,a)}};E.setCompleters([r])}return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidUpdate",value:function(){this.aceEditorRef.editor.resize()}},{key:"onSqlExpressionClauseChange",value:function(e){this.props.onChange(this.props.adhocFilter.duplicateWith({clause:e&&e.clause,expressionType:f.EXPRESSION_TYPES.SQL}))}},{key:"onSqlExpressionChange",value:function(e){this.props.onChange(this.props.adhocFilter.duplicateWith({sqlExpression:e,expressionType:f.EXPRESSION_TYPES.SQL}))}},{key:"handleAceEditorRef",value:function(e){e&&(this.aceEditorRef=e)}},{key:"render",value:function(){var e=this.props,t=e.adhocFilter,n=e.height,r={placeholder:(0,v.t)("choose WHERE or HAVING..."),options:Object.keys(f.CLAUSES).map((function(e){return{clause:e}})),value:t.clause,onChange:this.onSqlExpressionClauseChange,optionRenderer:(0,y.default)((function(e){return e.clause})),valueRenderer:function(e){return o.default.createElement("span",null,e.clause)},valueKey:"clause"};return o.default.createElement("span",null,o.default.createElement(u.FormGroup,{className:"filter-edit-clause-section"},o.default.createElement(m.default,a({},this.selectProps,r,{className:"filter-edit-clause-dropdown"})),o.default.createElement("span",{className:"filter-edit-clause-info"},o.default.createElement("strong",null,"Where")," filters by columns.",o.default.createElement("br",null),o.default.createElement("strong",null,"Having")," filters by metrics.")),o.default.createElement(u.FormGroup,null,o.default.createElement(i.default,{ref:this.handleAceEditorRef,mode:"sql",theme:"github",height:n-100+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:t.sqlExpression||t.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"adhoc-filter-sql-editor",wrapEnabled:!0})))}}]),t}(o.default.Component);t.default=C,C.propTypes=b},1673:function(e,t,n){"use strict";var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=g(n(54)),o=g(n(1)),l=g(n(0)),i=g(n(13)),u=g(n(274)),s=n(75),c=n(11),f=g(n(1072)),d=g(n(1082)),p=g(n(1083)),h=g(n(278)),m=g(n(401)),y=g(n(400));n(2832);var v=n(10);function g(e){return e&&e.__esModule?e:{default:e}}var b={time_range:"__time_range",granularity_sqla:"__time_col",time_grain_sqla:"__time_grain",druid_time_origin:"__time_origin",granularity:"__granularity"},E={origSelectedValues:l.default.object,instantFiltering:l.default.bool,filtersChoices:l.default.object,onChange:l.default.func,showDateFilter:l.default.bool,showSqlaTimeGrain:l.default.bool,showSqlaTimeColumn:l.default.bool,showDruidTimeGrain:l.default.bool,showDruidTimeOrigin:l.default.bool,datasource:l.default.object.isRequired},C={origSelectedValues:{},onChange:function(){},showDateFilter:!1,showSqlaTimeGrain:!1,showSqlaTimeColumn:!1,showDruidTimeGrain:!1,showDruidTimeOrigin:!1,instantFiltering:!0},O=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={selectedValues:e.origSelectedValues,hasChanged:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"getControlData",value:function(e){var t=Object.assign({},h.default[e]),n={name:e,key:"control-"+e,value:this.state.selectedValues[b[e]],actions:{setControlValue:this.changeFilter.bind(this)}};Object.assign(t,n);var a=t.mapStateToProps;return a?Object.assign({},t,a(this.props)):t}},{key:"clickApply",value:function(){var e=this,t=this.state.selectedValues;Object.keys(t).forEach((function(n,a,r){var o=!1;a===r.length-1&&(o=!0),e.props.onChange(n,t[n],!1,o)})),this.setState({hasChanged:!1})}},{key:"changeFilter",value:function(e,t){var n=b[e]||e,a=null;null!==t&&(a=Array.isArray(t)?t.map((function(e){return e.value})):t.value?t.value:t);var r=Object.assign({},this.state.selectedValues);r[n]=a,this.setState({selectedValues:r,hasChanged:!0}),this.props.instantFiltering&&this.props.onChange(n,a,!1,!0)}},{key:"render",value:function(){var e=this,t=void 0;this.props.showDateFilter&&(t=o.default.createElement("div",{className:"row space-1"},o.default.createElement("div",{className:"col-lg-12 col-xs-12"},o.default.createElement(f.default,{name:"__time_range",label:(0,v.t)("Time range"),description:(0,v.t)("Select start and end date"),onChange:this.changeFilter.bind(this,"__time_range"),value:this.state.selectedValues.__time_range}))));var n=[],a=[],l=[];for(var i in this.props.showSqlaTimeGrain&&a.push("time_grain_sqla"),this.props.showSqlaTimeColumn&&a.push("granularity_sqla"),this.props.showDruidTimeGrain&&l.push("granularity"),this.props.showDruidTimeOrigin&&l.push("druid_time_origin"),a.length&&n.push(o.default.createElement(d.default,{key:"sqla-filters",className:"control-row",controls:a.map((function(t){return o.default.createElement(p.default,e.getControlData(t))}))})),l.length&&n.push(o.default.createElement(d.default,{key:"druid-filters",className:"control-row",controls:l.map((function(t){return o.default.createElement(p.default,e.getControlData(t))}))})),this.state.selectedValues)if(this.state.selectedValues.hasOwnProperty(i)&&i in this.props.filtersChoices){var h=this.props.filtersChoices[i].map((function(e){return e.id})),g=!0,b=!1,E=void 0;try{for(var C,O=this.state.selectedValues[i][Symbol.iterator]();!(g=(C=O.next()).done);g=!0){var _=C.value;if(-1===h.indexOf(_)){var S={filter:i,id:_,text:_,metric:0};this.props.filtersChoices[i].unshift(S)}}}catch(e){b=!0,E=e}finally{try{!g&&O.return&&O.return()}finally{if(b)throw E}}}var T=Object.keys(this.props.filtersChoices).map((function(t){var n=e.props.filtersChoices[t],a={};return a[t]=r.default.max(n,(function(e){return e.metric})),o.default.createElement("div",{key:t,className:"m-b-5"},e.props.datasource.verbose_map[t]||t,o.default.createElement(m.default,{placeholder:(0,v.t)("Select [%s]",t),key:t,multi:!0,value:e.state.selectedValues[t],options:n.map((function(e){var t=Math.round(e.metric/a[e.filter]*100),n={backgroundImage:"linear-gradient(to right, lightgrey, lightgrey "+t+"%, rgba(0,0,0,0) "+t+"%",padding:"2px 5px"};return{value:e.id,label:e.id,style:n}})),onChange:e.changeFilter.bind(e,t),selectComponent:s.Creatable,selectWrap:u.default,optionRenderer:(0,y.default)((function(e){return e.label}))}))}));return o.default.createElement("div",{className:"scrollbar-container"},o.default.createElement("div",{className:"scrollbar-content"},t,n,T,!this.props.instantFiltering&&o.default.createElement(c.Button,{bsSize:"small",bsStyle:"primary",onClick:this.clickApply.bind(this),disabled:!this.state.hasChanged},(0,v.t)("Apply"))))}}]),t}(o.default.Component);O.propTypes=E,O.defaultProps=C,e.exports=function(e,t){r.default.select(e.selector).selectAll("*").remove();var n=e.formData,a={};n.groupby.forEach((function(e){a[e]=t.data[e]})),i.default.render(o.default.createElement(O,{filtersChoices:a,onChange:e.addFilter,showDateFilter:n.date_filter,showSqlaTimeGrain:n.show_sqla_time_granularity,showSqlaTimeColumn:n.show_sqla_time_column,showDruidTimeGrain:n.show_druid_time_granularity,showDruidTimeOrigin:n.show_druid_time_origin,datasource:e.datasource,origSelectedValues:e.getFilters()||{},instantFiltering:n.instant_filtering}),document.getElementById(e.containerId))}},232:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(0),o=(a=r)&&a.__esModule?a:{default:a};t.default=o.default.shape({column_name:o.default.string.isRequired,type:o.default.string})},2832:function(e,t,n){},299:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(0)),r=n(300),o=i(n(232)),l=n(362);function i(e){return e&&e.__esModule?e:{default:e}}t.default=a.default.oneOfType([a.default.shape({expressionType:a.default.oneOf([l.EXPRESSION_TYPES.SIMPLE]).isRequired,column:o.default.isRequired,aggregate:a.default.oneOf(Object.keys(r.AGGREGATES)).isRequired,label:a.default.string.isRequired}),a.default.shape({expressionType:a.default.oneOf([l.EXPRESSION_TYPES.SQL]).isRequired,sqlExpression:a.default.string.isRequired,label:a.default.string.isRequired})])},300:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AGGREGATES={AVG:"AVG",COUNT:"COUNT ",COUNT_DISTINCT:"COUNT_DISTINCT",MAX:"MAX",MIN:"MIN",SUM:"SUM"};var a=t.OPERATORS={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","not in":"not in",LIKE:"LIKE",regex:"regex","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL"};t.TABLE_ONLY_OPERATORS=[a.LIKE],t.DRUID_ONLY_OPERATORS=[a.regex],t.HAVING_OPERATORS=[a["=="],a["!="],a[">"],a["<"],a[">="],a["<="]],t.MULTI_OPERATORS=[a.in,a["not in"]],t.sqlaAutoGeneratedMetricNameRegex=/^(sum|min|max|avg|count|count_distinct)__.*$/i,t.sqlaAutoGeneratedMetricRegex=/^(LONG|DOUBLE|FLOAT)?(SUM|AVG|MAX|MIN|COUNT)\([A-Z0-9_."]*\)$/i,t.druidAutoGeneratedMetricRegex=/^(LONG|DOUBLE|FLOAT)?(SUM|MAX|MIN|COUNT)\([A-Z0-9_."]*\)$/i,t.EXPLORE_ONLY_VIZ_TYPE=["separator","markup"]},362:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXPRESSION_TYPES=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(300);var o=t.EXPRESSION_TYPES={SIMPLE:"SIMPLE",SQL:"SQL"};function l(e){if(e.sqlExpression&&r.sqlaAutoGeneratedMetricRegex.test(e.sqlExpression)){var t=e.sqlExpression.indexOf(")"),n=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&n>0)return e.sqlExpression.substring(n+1,t)}return null}function i(e){if(e.sqlExpression&&r.sqlaAutoGeneratedMetricRegex.test(e.sqlExpression)){var t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}var u=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.expressionType=t.expressionType||o.SIMPLE,this.expressionType===o.SIMPLE){var n=l(t);this.column=t.column||n&&{column_name:n},this.aggregate=t.aggregate||i(t),this.sqlExpression=null}else this.expressionType===o.SQL&&(this.sqlExpression=t.sqlExpression,this.column=null,this.aggregate=null);this.hasCustomLabel=!(!t.hasCustomLabel||!t.label),this.fromFormData=!!t.optionName,this.label=this.hasCustomLabel?t.label:this.getDefaultLabel(),this.optionName=t.optionName||"metric_"+Math.random().toString(36).substring(2,15)+"_"+Math.random().toString(36).substring(2,15)}return a(e,[{key:"getDefaultLabel",value:function(){var e=this.translateToSql();return e.length<43?e:e.substring(0,40)+"..."}},{key:"translateToSql",value:function(){return this.expressionType===o.SIMPLE?(this.aggregate||"")+"("+(this.column&&this.column.column_name||"")+")":this.expressionType===o.SQL?this.sqlExpression:""}},{key:"duplicateWith",value:function(t){return new e(Object.assign({},this,t))}},{key:"equals",value:function(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}},{key:"isValid",value:function(){return this.expressionType===o.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===o.SQL&&!!this.sqlExpression}},{key:"inferSqlExpressionAggregate",value:function(){return i(this)}},{key:"inferSqlExpressionColumn",value:function(){return l(this)}}]),e}();t.default=u},400:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};t.default=function(e){function t(t){var n=t.focusedOption,o=t.focusOption,l=t.key,i=t.option,u=t.selectValue,s=t.style,c=t.valueArray;if(!i)return null;var f=["VirtualizedSelectOption"];i===n&&f.push("VirtualizedSelectFocusedOption"),i.disabled&&f.push("VirtualizedSelectDisabledOption"),c&&c.indexOf(i)>=0&&f.push("VirtualizedSelectSelectedOption"),i.className&&f.push(i.className);var d=i.disabled?{}:{onClick:function(){return u(i)},onMouseEnter:function(){return o(i)}};return r.default.createElement("div",a({className:f.join(" "),key:l,style:Object.assign(i.style||{},s),title:i.title},d),e(i))}return t.propTypes={focusedOption:o.default.object.isRequired,focusOption:o.default.func.isRequired,key:o.default.string,option:o.default.object,selectValue:o.default.func.isRequired,style:o.default.object,valueArray:o.default.array},t};var r=l(n(1)),o=l(n(0));function l(e){return e&&e.__esModule?e:{default:e}}},401:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=u(n(1)),l=u(n(0)),i=u(n(75));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function t(){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"onPaste",value:function(e){var t=this;if(this.props.multi){e.preventDefault();var n=e.clipboardData.getData("Text");if(n){var a="["+this.props.separator+"]+",r=n.split(new RegExp(a)).map((function(e){return e.trim()})),o=this.props.isValidNewOption,l=this.props.value||[],i={},u={};this.props.options.forEach((function(e){i[e[t.props.valueKey]]=1}));var c=[];l.forEach((function(e){var n;c.push((s(n={},t.props.labelKey,e),s(n,t.props.valueKey,e),n)),u[e]=1})),(c=c.concat(r.filter((function(e){var n=!u[e];return u[e]=1,n&&(o?o(s({},t.props.labelKey,e)):!!e)})).map((function(e){var n,a=(s(n={},t.props.labelKey,e),s(n,t.props.valueKey,e),n);return i[e]||t.props.options.unshift(a),a})))).length&&this.props.onChange&&this.props.onChange(c)}}}},{key:"render",value:function(){var e=this,t=this.props.selectWrap,n=function(t){e.props.refFunc&&e.props.refFunc(t),e.pasteInput=t},r={onPaste:this.onPaste.bind(this)};return o.default.createElement(t,a({},this.props,{ref:n,inputProps:r}))}}]),t}(o.default.Component);t.default=d,d.propTypes={separator:l.default.string.isRequired,selectWrap:l.default.func.isRequired,refFunc:l.default.func,onChange:l.default.func.isRequired,valueKey:l.default.string.isRequired,labelKey:l.default.string.isRequired,options:l.default.array,multi:l.default.bool.isRequired,value:l.default.any,isValidNewOption:l.default.func},d.defaultProps={separator:",",selectWrap:i.default,valueKey:"value",labelKey:"label",options:[],multi:!1}},411:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=h(n(1)),l=h(n(0)),i=h(n(274)),u=n(75),s=h(u),c=h(n(66)),f=n(10),d=h(n(400)),p=h(n(401));function h(e){return e&&e.__esModule?e:{default:e}}var m={choices:l.default.array,clearable:l.default.bool,description:l.default.string,disabled:l.default.bool,freeForm:l.default.bool,isLoading:l.default.bool,label:l.default.string,multi:l.default.bool,name:l.default.string.isRequired,onChange:l.default.func,onFocus:l.default.func,value:l.default.oneOfType([l.default.string,l.default.number,l.default.array]),showHeader:l.default.bool,optionRenderer:l.default.func,valueRenderer:l.default.func,valueKey:l.default.string,options:l.default.array,placeholder:l.default.string,noResultsText:l.default.string,refFunc:l.default.func,filterOption:l.default.func},y={choices:[],clearable:!0,description:null,disabled:!1,freeForm:!1,isLoading:!1,label:null,multi:!1,onChange:function(){},onFocus:function(){},showHeader:!0,optionRenderer:function(e){return e.label},valueRenderer:function(e){return e.label},valueKey:"value",noResultsText:(0,f.t)("No results found")},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={options:n.getOptions(e)},n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillReceiveProps",value:function(e){if(e.choices!==this.props.choices||e.options!==this.props.options){var t=this.getOptions(e);this.setState({options:t})}}},{key:"onChange",value:function(e){var t=this,n=e?e[this.props.valueKey]:null;this.props.multi&&(n=e?e.map((function(e){return e[t.props.valueKey]})):null),this.props.onChange(n)}},{key:"getOptions",value:function(e){if(e.options)return e.options;var t=e.choices.map((function(e){var t=void 0;if(Array.isArray(e)){var n=e.length>1?e[1]:e[0];t={value:e[0],label:n}}else t=Object.is(e)?e:{value:e,label:e};return t}));if(e.freeForm){var n=t.map((function(e){return e.value}));if(e.value){var a=e.value;Array.isArray(a)||(a=[a]),a.forEach((function(e){n.indexOf(e)<0&&t.push({value:e,label:e})}))}}return t}},{key:"render",value:function(){var e=this.props.placeholder||(0,f.t)("%s option(s)",this.state.options.length),t={multi:this.props.multi,name:"select-"+this.props.name,placeholder:e,options:this.state.options,value:this.props.value,labelKey:"label",valueKey:this.props.valueKey,autosize:!1,clearable:this.props.clearable,isLoading:this.props.isLoading,onChange:this.onChange,onFocus:this.props.onFocus,optionRenderer:(0,d.default)(this.props.optionRenderer),valueRenderer:this.props.valueRenderer,noResultsText:this.props.noResultsText,selectComponent:this.props.freeForm?u.Creatable:s.default,disabled:this.props.disabled,refFunc:this.props.refFunc,filterOption:this.props.filterOption};return o.default.createElement("div",null,this.props.showHeader&&o.default.createElement(c.default,this.props),o.default.createElement(p.default,a({},t,{selectWrap:i.default})))}}]),t}(o.default.PureComponent);t.default=v,v.propTypes=m,v.defaultProps=y},412:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLAUSES=t.EXPRESSION_TYPES=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(300);var o=t.EXPRESSION_TYPES={SIMPLE:"SIMPLE",SQL:"SQL"},l=(t.CLAUSES={HAVING:"HAVING",WHERE:"WHERE"},{"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",in:"in","not in":"not in",LIKE:"like",regex:"regex","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL"});function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.useSimple;if(e.expressionType===o.SIMPLE||n){var a=r.MULTI_OPERATORS.indexOf(e.operator)>=0,i=e.subject,u=l[e.operator],s=a?e.comparator.join("','"):e.comparator;return i+" "+u+" "+(a?"('":"")+s+(a?"')":"")}return e.expressionType===o.SQL?e.sqlExpression:""}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.expressionType=t.expressionType||o.SIMPLE,this.expressionType===o.SIMPLE?(this.subject=t.subject,this.operator=t.operator,this.comparator=t.comparator,this.clause=t.clause,this.sqlExpression=null):this.expressionType===o.SQL&&(this.sqlExpression="string"==typeof t.sqlExpression?t.sqlExpression:i(t,{useSimple:!0}),this.clause=t.clause,this.subject=null,this.operator=null,this.comparator=null),this.fromFormData=!!t.filterOptionName,this.filterOptionName=t.filterOptionName||"filter_"+Math.random().toString(36).substring(2,15)+"_"+Math.random().toString(36).substring(2,15)}return a(e,[{key:"duplicateWith",value:function(t){return new e(Object.assign({},this,{expressionType:this.expressionType,subject:this.subject,operator:this.operator,clause:this.clause,sqlExpression:this.sqlExpression,fromFormData:this.fromFormData,filterOptionName:this.filterOptionName},t))}},{key:"equals",value:function(e){return e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.comparator===this.comparator&&e.subject===this.subject}},{key:"isValid",value:function(){return this.expressionType===o.SIMPLE?"IS NOT NULL"===this.operator||"IS NULL"===this.operator?!(!this.operator||!this.subject):!!(this.operator&&this.subject&&this.comparator&&this.comparator.length>0&&this.clause):this.expressionType===o.SQL&&!(!this.sqlExpression||!this.clause)}},{key:"getDefaultLabel",value:function(){var e=this.translateToSql();return e.length<43?e:e.substring(0,40)+"..."}},{key:"translateToSql",value:function(){return i(this)}}]),e}();t.default=u},463:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=s(n(1)),o=s(n(0)),l=n(11),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(279)),u=s(n(66));function s(e){return e&&e.__esModule?e:{default:e}}var c={onChange:o.default.func,onFocus:o.default.func,value:o.default.oneOfType([o.default.string,o.default.number]),isFloat:o.default.bool,isInt:o.default.bool,disabled:o.default.bool},f={onChange:function(){},onFocus:function(){},value:"",isInt:!1,isFloat:!1,disabled:!1},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(e){var t=e.target.value,n=[];if(""!==t&&this.props.isFloat){var a=i.numeric(t);a?n.push(a):t=parseFloat(t)}if(""!==t&&this.props.isInt){var r=i.integer(t);r?n.push(r):t=parseInt(t,10)}this.props.onChange(t,n)}},{key:"render",value:function(){var e=this.props.value,t=null!=e?e.toString():"";return r.default.createElement("div",null,r.default.createElement(u.default,this.props),r.default.createElement(l.FormGroup,{controlId:"formInlineName",bsSize:"small"},r.default.createElement(l.FormControl,{type:"text",placeholder:"",onChange:this.onChange,onFocus:this.props.onFocus,value:t,disabled:this.props.disabled})))}}]),t}(r.default.Component);t.default=d,d.propTypes=c,d.defaultProps=f},557:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=s(n(1)),l=s(n(0)),i=s(n(66)),u=s(n(564));function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d={name:l.default.string,value:l.default.bool,label:l.default.string,description:l.default.string,onChange:l.default.func},p={value:!1,onChange:function(){}},h={paddingRight:"5px"},m=function(e){function t(){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"onChange",value:function(){this.props.onChange(!this.props.value)}},{key:"renderCheckbox",value:function(){return o.default.createElement(u.default,{onChange:this.onChange.bind(this),style:h,checked:!!this.props.value})}},{key:"render",value:function(){return this.props.label?o.default.createElement(i.default,a({},this.props,{leftNode:this.renderCheckbox()})):this.renderCheckbox()}}]),t}(o.default.Component);t.default=m,m.propTypes=d,m.defaultProps=p},558:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var a=l(n(1)),r=l(n(0)),o=l(n(68));function l(e){return e&&e.__esModule?e:{default:e}}var i={title:r.default.string.isRequired,isSelected:r.default.bool.isRequired,onSelect:r.default.func.isRequired,info:r.default.string,children:r.default.node.isRequired};function u(e){var t=e.title,n=e.isSelected,r=e.children,l=e.onSelect,i=e.info;return a.default.createElement("div",{className:"PopoverSection "+(n?"":"dimmed")},a.default.createElement("div",{onClick:l,className:"pointer"},a.default.createElement("strong",null,t),"  ",i&&a.default.createElement(o.default,{tooltip:i,label:"date-free-tooltip"})," ",a.default.createElement("i",{className:n?"fa fa-check text-primary":""})),a.default.createElement("div",{className:"m-t-5 m-l-5"},r))}u.propTypes=i},560:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(0),o=(a=r)&&a.__esModule?a:{default:a};t.default=o.default.shape({metric_name:o.default.string.isRequired,expression:o.default.string.isRequired})},562:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sqlWords=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=s(n(1)),o=s(n(0)),l=s(n(275));n(363),n(364),n(467);var i=s(n(282)),u=n(254);function s(e){return e&&e.__esModule?e:{default:e}}var c=i.default.acequire("ace/ext/language_tools"),f=[].concat("SELECT|INSERT|UPDATE|DELETE|FROM|WHERE|AND|OR|GROUP|BY|ORDER|LIMIT|OFFSET|HAVING|AS|CASE|WHEN|ELSE|END|TYPE|LEFT|RIGHT|JOIN|ON|OUTER|DESC|ASC|UNION|CREATE|TABLE|PRIMARY|KEY|IF|FOREIGN|NOT|REFERENCES|DEFAULT|NULL|INNER|CROSS|NATURAL|DATABASE|DROP|GRANT|SUM|MAX|MIN|COUNT|AVG|DISTINCT".split("|"),"INT|NUMERIC|DECIMAL|DATE|VARCHAR|CHAR|BIGINT|FLOAT|DOUBLE|BIT|BINARY|TEXT|SET|TIMESTAMP|MONEY|REAL|NUMBER|INTEGER".split("|")),d=t.sqlWords=f.map((function(e){return{name:e,value:e,score:60,meta:"sql"}})),p={actions:o.default.object.isRequired,onBlur:o.default.func,sql:o.default.string.isRequired,tables:o.default.array,queryEditor:o.default.object.isRequired,height:o.default.string,hotkeys:o.default.arrayOf(o.default.shape({key:o.default.string.isRequired,descr:o.default.string.isRequired,func:o.default.func.isRequired})),onChange:o.default.func},h={onBlur:function(){},onChange:function(){},tables:[]},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={sql:e.sql,selectedText:""},n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){this.props.actions.queryEditorSetSelectedText(this.props.queryEditor,null),this.setAutoCompleter(this.props)}},{key:"componentWillReceiveProps",value:function(e){(0,u.areArraysShallowEqual)(this.props.tables,e.tables)||this.setAutoCompleter(e),e.sql!==this.props.sql&&this.setState({sql:e.sql})}},{key:"onBlur",value:function(){this.props.onBlur(this.state.sql)}},{key:"onAltEnter",value:function(){this.props.onBlur(this.state.sql)}},{key:"onEditorLoad",value:function(e){var t=this;e.commands.addCommand({name:"runQuery",bindKey:{win:"Alt-enter",mac:"Alt-enter"},exec:function(){t.onAltEnter()}}),this.props.hotkeys.forEach((function(t){e.commands.addCommand({name:t.name,bindKey:{win:t.key,mac:t.key},exec:t.func})})),e.$blockScrolling=1/0,e.selection.on("changeSelection",(function(){var n=e.getSelectedText();n!==t.state.selectedText&&1!==n.length&&(t.setState({selectedText:n}),t.props.actions.queryEditorSetSelectedText(t.props.queryEditor,n))}))}},{key:"onChange",value:function(e){this.setState({sql:e}),this.props.onChange(e)}},{key:"getCompletions",value:function(e,t,n,a,r){r(null,this.state.words)}},{key:"setAutoCompleter",value:function(e){var t=this,n=[],a={};(e.tables||[]).forEach((function(e){n.push({name:e.name,value:e.name,score:55,meta:"table"}),(e.columns||[]).forEach((function(e){a[e.name]=null}))})),n=n.concat(Object.keys(a).map((function(e){return{name:e,value:e,score:50,meta:"column"}})),d),this.setState({words:n},(function(){var e={getCompletions:t.getCompletions.bind(t)};c&&c.setCompleters([e])}))}},{key:"render",value:function(){return r.default.createElement(l.default,{mode:"sql",theme:"github",onLoad:this.onEditorLoad.bind(this),onBlur:this.onBlur.bind(this),height:this.props.height,onChange:this.onChange,width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.sql})}}]),t}(r.default.PureComponent);m.defaultProps=h,m.propTypes=p,t.default=m},565:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=s(n(1)),l=s(n(0)),i=s(n(75)),u=n(10);function s(e){return e&&e.__esModule?e:{default:e}}var c=window.$=n(21),f={dataEndpoint:l.default.string.isRequired,onChange:l.default.func.isRequired,mutator:l.default.func.isRequired,onAsyncError:l.default.func,value:l.default.oneOfType([l.default.number,l.default.arrayOf(l.default.number)]),valueRenderer:l.default.func,placeholder:l.default.string,autoSelect:l.default.bool},d={placeholder:(0,u.t)("Select ..."),valueRenderer:function(e){return o.default.createElement("div",null,e.label)},onAsyncError:function(){}},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isLoading:!1,options:[]},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidMount",value:function(){this.fetchOptions()}},{key:"onChange",value:function(e){this.props.onChange(e)}},{key:"fetchOptions",value:function(){var e=this;this.setState({isLoading:!0});var t=this.props.mutator;c.get(this.props.dataEndpoint).done((function(n){e.setState({options:t?t(n):n,isLoading:!1}),!e.props.value&&e.props.autoSelect&&e.state.options.length&&e.onChange(e.state.options[0])})).fail((function(t){e.props.onAsyncError(t.responseText)})).always((function(){e.setState({isLoading:!1})}))}},{key:"render",value:function(){return o.default.createElement("div",null,o.default.createElement(i.default,a({placeholder:this.props.placeholder,options:this.state.options,value:this.props.value,isLoading:this.state.isLoading,onChange:this.onChange.bind(this),valueRenderer:this.props.valueRenderer},this.props)))}}]),t}(o.default.PureComponent);p.propTypes=f,p.defaultProps=d,t.default=p},612:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var a=i(n(1)),r=i(n(0)),o=i(n(301)),l=i(n(68));function i(e){return e&&e.__esModule?e:{default:e}}var u={metric:r.default.object.isRequired,openInNewWindow:r.default.bool,showFormula:r.default.bool,showType:r.default.bool,url:r.default.string};function s(e){var t=e.metric,n=e.openInNewWindow,r=e.showFormula,i=e.showType,u=e.url,s=t.verbose_name||t.metric_name||t.label,c=u?a.default.createElement("a",{href:u,target:n?"_blank":null},s):s;return a.default.createElement("div",null,i&&a.default.createElement(o.default,{type:"expression"}),a.default.createElement("span",{className:"m-r-5 option-label"},c),t.description&&a.default.createElement(l.default,{className:"m-r-5 text-muted",icon:"info",tooltip:t.description,label:"descr-"+t.metric_name}),r&&a.default.createElement(l.default,{className:"m-r-5 text-muted",icon:"question-circle-o",tooltip:t.expression,label:"expr-"+t.metric_name}),t.warning_text&&a.default.createElement(l.default,{className:"m-r-5 text-danger",icon:"warning",tooltip:t.warning_text,label:"warn-"+t.metric_name}))}s.propTypes=u,s.defaultProps={showFormula:!0,showType:!1}},66:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=s(n(1)),o=s(n(0)),l=n(11),i=s(n(68)),u=n(10);function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d={label:o.default.string,description:o.default.string,validationErrors:o.default.array,renderTrigger:o.default.bool,rightNode:o.default.node,leftNode:o.default.node,onClick:o.default.func,hovered:o.default.bool,tooltipOnClick:o.default.func,warning:o.default.string,danger:o.default.string},p=function(e){function t(){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"renderOptionalIcons",value:function(){return this.props.hovered?r.default.createElement("span",null,this.props.description&&r.default.createElement("span",null,r.default.createElement(i.default,{label:(0,u.t)("description"),tooltip:this.props.description,placement:"top",onClick:this.props.tooltipOnClick})," "),this.props.renderTrigger&&r.default.createElement("span",null,r.default.createElement(i.default,{label:(0,u.t)("bolt"),tooltip:(0,u.t)("Changing this control takes effect instantly"),placement:"top",icon:"bolt"})," ")):null}},{key:"render",value:function(){if(!this.props.label)return null;var e=this.props.validationErrors.length>0?"text-danger":"";return r.default.createElement("div",{className:"ControlHeader"},r.default.createElement("div",{className:"pull-left"},r.default.createElement(l.ControlLabel,null,this.props.leftNode&&r.default.createElement("span",null,this.props.leftNode),r.default.createElement("span",{onClick:this.props.onClick,className:e,style:{cursor:this.props.onClick?"pointer":""}},this.props.label)," ",this.props.warning&&r.default.createElement("span",null,r.default.createElement(l.OverlayTrigger,{placement:"top",overlay:r.default.createElement(l.Tooltip,{id:"error-tooltip"},this.props.warning)},r.default.createElement("i",{className:"fa fa-exclamation-circle text-warning"}))," "),this.props.danger&&r.default.createElement("span",null,r.default.createElement(l.OverlayTrigger,{placement:"top",overlay:r.default.createElement(l.Tooltip,{id:"error-tooltip"},this.props.danger)},r.default.createElement("i",{className:"fa fa-exclamation-circle text-danger"}))," "),this.props.validationErrors.length>0&&r.default.createElement("span",null,r.default.createElement(l.OverlayTrigger,{placement:"top",overlay:r.default.createElement(l.Tooltip,{id:"error-tooltip"},this.props.validationErrors.join(" "))},r.default.createElement("i",{className:"fa fa-exclamation-circle text-danger"}))," "),this.renderOptionalIcons())),this.props.rightNode&&r.default.createElement("div",{className:"pull-right"},this.props.rightNode),r.default.createElement("div",{className:"clearfix"}))}}]),t}(r.default.Component);t.default=p,p.propTypes=d,p.defaultProps={validationErrors:[],renderTrigger:!1,hovered:!1}},810:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=_(n(1084)),r=_(n(897)),o=_(n(557)),l=_(n(1599)),i=_(n(1605)),u=_(n(1606)),s=_(n(1607)),c=_(n(1072)),f=_(n(1648)),d=_(n(1649)),p=_(n(899)),h=_(n(411)),m=_(n(900)),y=_(n(898)),v=_(n(463)),g=_(n(1650)),b=_(n(1651)),E=_(n(1653)),C=_(n(1654)),O=_(n(1661));function _(e){return e&&e.__esModule?e:{default:e}}var S={AnnotationLayerControl:a.default,BoundsControl:r.default,CheckboxControl:o.default,CollectionControl:l.default,ColorPickerControl:i.default,ColorSchemeControl:u.default,DatasourceControl:s.default,DateFilterControl:c.default,FixedOrMetricControl:f.default,HiddenControl:d.default,SelectAsyncControl:p.default,SelectControl:h.default,SpatialControl:m.default,TextAreaControl:y.default,TextControl:v.default,TimeSeriesColumnControl:g.default,ViewportControl:b.default,VizTypeControl:E.default,MetricsControl:C.default,AdhocFilterControl:O.default};t.default=S},897:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=s(n(1)),o=s(n(0)),l=n(11),i=s(n(66)),u=n(10);function s(e){return e&&e.__esModule?e:{default:e}}var c={onChange:o.default.func,value:o.default.array},f={onChange:function(){},value:[null,null]},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={minMax:[null===e.value[0]?"":e.value[0],null===e.value[1]?"":e.value[1]]},n.onChange=n.onChange.bind(n),n.onMinChange=n.onMinChange.bind(n),n.onMaxChange=n.onMaxChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onMinChange",value:function(e){this.setState({minMax:[e.target.value,this.state.minMax[1]]},this.onChange)}},{key:"onMaxChange",value:function(e){this.setState({minMax:[this.state.minMax[0],e.target.value]},this.onChange)}},{key:"onChange",value:function(){var e=this.state.minMax,t=[];e[0]&&isNaN(e[0])&&t.push((0,u.t)("`Min` value should be numeric or empty")),e[1]&&isNaN(e[1])&&t.push((0,u.t)("`Max` value should be numeric or empty")),0===t.length?this.props.onChange([parseFloat(e[0]),parseFloat(e[1])],t):this.props.onChange([null,null],t)}},{key:"render",value:function(){return r.default.createElement("div",null,r.default.createElement(i.default,this.props),r.default.createElement(l.FormGroup,{bsSize:"small"},r.default.createElement(l.Row,null,r.default.createElement(l.Col,{xs:6},r.default.createElement(l.FormControl,{type:"text",placeholder:(0,u.t)("Min"),onChange:this.onMinChange,value:this.state.minMax[0]})),r.default.createElement(l.Col,{xs:6},r.default.createElement(l.FormControl,{type:"text",placeholder:(0,u.t)("Max"),onChange:this.onMaxChange,value:this.state.minMax[1]})))))}}]),t}(r.default.Component);t.default=d,d.propTypes=c,d.defaultProps=f},898:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=f(n(1)),o=f(n(0)),l=n(11),i=f(n(275));n(363),n(643),n(645),n(493),n(1610),n(494);var u=f(n(66)),s=f(n(92)),c=n(10);function f(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h={name:o.default.string,onChange:o.default.func,value:o.default.string,height:o.default.number,minLines:o.default.number,maxLines:o.default.number,offerEditInModal:o.default.bool,language:o.default.oneOf([null,"json","html","sql","markdown","javascript"]),aboveEditorSection:o.default.node,readOnly:o.default.bool},m={onChange:function(){},value:"",height:250,minLines:3,maxLines:10,offerEditInModal:!0,readOnly:!1},y=function(e){function t(){return d(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onControlChange",value:function(e){this.props.onChange(e.target.value)}},{key:"onAceChange",value:function(e){this.props.onChange(e)}},{key:"renderEditor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.props.value||"";return this.props.language?r.default.createElement(i.default,{mode:this.props.language,theme:"textmate",style:{border:"1px solid #CCC"},minLines:e?40:this.props.minLines,maxLines:e?1e3:this.props.maxLines,onChange:this.onAceChange.bind(this),width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:t,readOnly:this.props.readOnly}):r.default.createElement(l.FormGroup,{controlId:"formControlsTextarea"},r.default.createElement(l.FormControl,{componentClass:"textarea",placeholder:(0,c.t)("textarea"),onChange:this.onControlChange.bind(this),value:t,disabled:this.props.readOnly,style:{height:this.props.height}}))}},{key:"renderModalBody",value:function(){return r.default.createElement("div",null,r.default.createElement("div",null,this.props.aboveEditorSection),this.renderEditor(!0))}},{key:"render",value:function(){var e=r.default.createElement(u.default,this.props);return r.default.createElement("div",null,e,this.renderEditor(),this.props.offerEditInModal&&r.default.createElement(s.default,{bsSize:"large",modalTitle:e,triggerNode:r.default.createElement(l.Button,{bsSize:"small",className:"m-t-5"},(0,c.t)("Edit")," ",r.default.createElement("strong",null,this.props.language)," ",(0,c.t)("in modal")),modalBody:this.renderModalBody(!0)}))}}]),t}(r.default.Component);t.default=y,y.propTypes=h,y.defaultProps=m},899:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(1)),r=s(n(0)),o=s(n(565)),l=s(n(66)),i=n(10),u=s(n(329));function s(e){return e&&e.__esModule?e:{default:e}}var c={dataEndpoint:r.default.string.isRequired,multi:r.default.bool,mutator:r.default.func,onAsyncErrorMessage:r.default.string,onChange:r.default.func,placeholder:r.default.string,value:r.default.oneOfType([r.default.string,r.default.number,r.default.arrayOf(r.default.string),r.default.arrayOf(r.default.number)]),addDangerToast:r.default.func.isRequired},f={multi:!0,onAsyncErrorMessage:(0,i.t)("Error while fetching data"),onChange:function(){},placeholder:(0,i.t)("Select ...")},d=function(e){var t=e.value,n=e.onChange,r=e.dataEndpoint,i=e.multi,u=e.mutator,s=e.placeholder,c=e.onAsyncErrorMessage,f=function(e){var t=void 0;t=i?e.map((function(e){return e.value})):e?e.value:null,n(t)};return a.default.createElement("div",null,a.default.createElement(l.default,e),a.default.createElement(o.default,{dataEndpoint:r,onChange:f,onAsyncError:function(e){return(void 0).props.addDangerToast(c+": "+e)},mutator:u,multi:i,value:t,placeholder:s,valueRenderer:function(e){return a.default.createElement("div",null,e.label)}}))};d.propTypes=c,d.defaultProps=f,t.default=(0,u.default)(d)},900:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=d(n(1)),o=d(n(0)),l=n(11);n(901);var i=d(n(66)),u=d(n(411)),s=d(n(558)),c=d(n(564)),f=n(10);function d(e){return e&&e.__esModule?e:{default:e}}var p="latlong",h="delimited",m="geohash",y={onChange:o.default.func,value:o.default.object,animation:o.default.bool,choices:o.default.array},v={onChange:function(){},animation:!0,choices:[]},g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),a=e.value||{},r=void 0;return e.choices.length>0&&(r=e.choices[0][0]),n.state={type:a.type||p,delimiter:a.delimiter||",",latCol:a.latCol||r,lonCol:a.lonCol||r,lonlatCol:a.lonlatCol||r,reverseCheckbox:a.reverseCheckbox||!1,geohashCol:a.geohashCol||r,value:null,errors:[]},n.toggleCheckbox=n.toggleCheckbox.bind(n),n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){this.onChange()}},{key:"onChange",value:function(){var e=this.state.type,t={type:e},n=[],a=(0,f.t)("Invalid lat/long configuration.");e===p?(t.latCol=this.state.latCol,t.lonCol=this.state.lonCol,t.lonCol&&t.latCol||n.push(a)):e===h?(t.lonlatCol=this.state.lonlatCol,t.delimiter=this.state.delimiter,t.reverseCheckbox=this.state.reverseCheckbox,t.lonlatCol&&t.delimiter||n.push(a)):e===m&&(t.geohashCol=this.state.geohashCol,t.geohashCol||n.push(a)),this.setState({value:t,errors:n}),this.props.onChange(t,n)}},{key:"setType",value:function(e){this.setState({type:e},this.onChange)}},{key:"close",value:function(){this.refs.trigger.hide()}},{key:"toggleCheckbox",value:function(){this.setState({reverseCheckbox:!this.state.reverseCheckbox},this.onChange)}},{key:"renderLabelContent",value:function(){return this.state.errors.length>0?"N/A":this.state.type===p?this.state.lonCol+" | "+this.state.latCol:this.state.type===h?""+this.state.lonlatCol:this.state.type===m?""+this.state.geohashCol:null}},{key:"renderSelect",value:function(e,t){var n=this;return r.default.createElement(u.default,{name:e,choices:this.props.choices,value:this.state[e],clearable:!1,onFocus:function(){n.setType(t)},onChange:function(t){n.setState(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t),n.onChange)}})}},{key:"renderPopover",value:function(){return r.default.createElement(l.Popover,{id:"filter-popover"},r.default.createElement("div",{style:{width:"300px"}},r.default.createElement(s.default,{title:(0,f.t)("Longitude & Latitude columns"),isSelected:this.state.type===p,onSelect:this.setType.bind(this,p)},r.default.createElement(l.Row,null,r.default.createElement(l.Col,{md:6},"Longitude",this.renderSelect("lonCol",p)),r.default.createElement(l.Col,{md:6},"Latitude",this.renderSelect("latCol",p)))),r.default.createElement(s.default,{title:(0,f.t)("Delimited long & lat single column"),info:(0,f.t)("Multiple formats accepted, look the geopy.points Python library for more details"),isSelected:this.state.type===h,onSelect:this.setType.bind(this,h)},r.default.createElement(l.Row,null,r.default.createElement(l.Col,{md:6},"Column",this.renderSelect("lonlatCol",h)),r.default.createElement(l.Col,{md:6},(0,f.t)("Reverse lat/long "),r.default.createElement(c.default,{checked:this.state.reverseCheckbox,onChange:this.toggleCheckbox})))),r.default.createElement(s.default,{title:(0,f.t)("Geohash"),isSelected:this.state.type===m,onSelect:this.setType.bind(this,m)},r.default.createElement(l.Row,null,r.default.createElement(l.Col,{md:6},"Column",this.renderSelect("geohashCol",m)))),r.default.createElement("div",{className:"clearfix"},r.default.createElement(l.Button,{bsSize:"small",className:"float-left ok",bsStyle:"primary",onClick:this.close.bind(this)},"Ok"))))}},{key:"render",value:function(){return r.default.createElement("div",null,r.default.createElement(i.default,this.props),r.default.createElement(l.OverlayTrigger,{animation:this.props.animation,container:document.body,trigger:"click",rootClose:!0,ref:"trigger",placement:"right",overlay:this.renderPopover()},r.default.createElement(l.Label,{style:{cursor:"pointer"}},this.renderLabelContent())))}}]),t}(r.default.Component);t.default=g,g.propTypes=y,g.defaultProps=v},902:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=s(n(1)),o=s(n(0)),l=n(11),i=n(903),u=s(n(904));function s(e){return e&&e.__esModule?e:{default:e}}var c={children:o.default.node,onChange:o.default.func,item:o.default.object,title:o.default.node,compact:o.default.bool},f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(e,t){return this.props.onChange(Object.assign({},this.props.item,(r=t,(a=e)in(n={})?Object.defineProperty(n,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[a]=r,n)));var n,a,r}},{key:"render",value:function(){var e=this,t=this.props.title,n=function(t){return{onChange:e.onChange,value:e.props.item[t.props.fieldKey],compact:e.props.compact}};return r.default.createElement(l.Form,{componentClass:"fieldset",className:"CRUD"},t&&r.default.createElement("legend",null,t),(0,i.recurseReactClone)(this.props.children,u.default,n))}}]),t}(r.default.PureComponent);t.default=f,f.propTypes=c,f.defaultProps={compact:!1}},903:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recurseReactClone=function e(t,n,a){return o.default.Children.map(t,(function(t){var r=t;return t&&t.type===n&&(r=o.default.cloneElement(t,a(t))),r&&r.props.children&&(r=o.default.cloneElement(r,{children:e(r.props.children,n,a)})),r}))};var a,r=n(1),o=(a=r)&&a.__esModule?a:{default:a}},904:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=i(n(1)),o=i(n(0)),l=n(11);function i(e){return e&&e.__esModule?e:{default:e}}n(1612);var u={value:o.default.any,label:o.default.string,descr:o.default.node,fieldKey:o.default.string.isRequired,control:o.default.node.isRequired,onChange:o.default.func,compact:o.default.bool},s={controlProps:{},onChange:function(){},compact:!1},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"onChange",value:function(e){this.props.onChange(this.props.fieldKey,e)}},{key:"render",value:function(){var e=this.props,t=e.compact,n=e.value,a=e.label,o=e.control,i=e.descr,u=e.fieldKey,s=r.default.cloneElement(o,{value:n,onChange:this.onChange});return r.default.createElement(l.FormGroup,{controlId:u},r.default.createElement(l.ControlLabel,{className:"m-r-5"},a||u,t&&i&&r.default.createElement(l.OverlayTrigger,{placement:"right",overlay:r.default.createElement(l.Tooltip,{id:"field-descr",bsSize:"lg"},i)},r.default.createElement("i",{className:"fa fa-info-circle m-l-5"}))),s,r.default.createElement(l.FormControl.Feedback,null),!t&&i&&r.default.createElement(l.HelpBlock,null,i))}}]),t}(r.default.PureComponent);t.default=c,c.propTypes=u,c.defaultProps=s},913:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(0),o=(a=r)&&a.__esModule?a:{default:a};t.default=o.default.shape({aggregate_name:o.default.string.isRequired})},914:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=d;var a=c(n(1)),r=c(n(0)),o=c(n(302)),l=c(n(301)),i=c(n(1666)),u=c(n(232)),s=c(n(299));function c(e){return e&&e.__esModule?e:{default:e}}var f={option:r.default.oneOfType([u.default,r.default.shape({saved_metric_name:r.default.string.isRequired}),s.default]).isRequired};function d(e){var t=e.option;return t.saved_metric_name?a.default.createElement("div",null,a.default.createElement(l.default,{type:"expression"}),a.default.createElement("span",{className:"m-r-5 option-label"},t.saved_metric_name)):t.column_name?a.default.createElement(o.default,{column:t,showType:!0}):t.label?a.default.createElement(i.default,{adhocMetric:t,showType:!0}):void 0}d.propTypes=f}}]);