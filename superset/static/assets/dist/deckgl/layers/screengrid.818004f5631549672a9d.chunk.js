(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{1075:function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=c(r(1)),o=c(r(13)),i=c(r(0)),s=r(2446),u=c(r(2533)),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(2449)),p=r(2534),f=c(r(611));function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t,r,n){var a=e,o=a.color_picker,i=t.data.features.map((function(e){return Object.assign({},e,{color:[o.r,o.g,o.b,255*o.a]})}));if(a.js_data_mutator){var u=(0,f.default)(a.js_data_mutator);i=u(i)}return null!=n&&n.forEach((function(e){i=i.filter(e)})),new s.ScreenGridLayer(Object.assign({id:"screengrid-layer-"+a.slice_id,data:i,pickable:!0,cellSizePixels:a.grid_size,minColor:[o.r,o.g,o.b,0],maxColor:[o.r,o.g,o.b,255*o.a],outline:!1,getWeight:function(e){return e.weight||0}},l.commonLayerProps(a,r)))}var h={slice:i.default.object.isRequired,payload:i.default.object.isRequired,setControlValue:i.default.func.isRequired,viewport:i.default.object.isRequired},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state=t.getDerivedStateFromProps(e),r.getLayers=r.getLayers.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,null,[{key:"getDerivedStateFromProps",value:function(e){var t=e.slice.formData,r=t.time_grain_sqla||t.granularity||"PT1M",n=e.payload.data.features.map((function(e){return e.__timestamp})),a=(0,p.getPlaySliderParams)(n,r);return{start:a.start,end:a.end,step:a.step,values:a.values,disabled:a.disabled}}}]),n(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(t.getDerivedStateFromProps(e,this.state))}},{key:"getLayers",value:function(e){var t=[];return e[0]===e[1]||e[1]===this.end?t.push((function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]})):t.push((function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]})),[d(this.props.slice.formData,this.props.payload,this.props.slice,t)]}},{key:"render",value:function(){return a.default.createElement("div",null,a.default.createElement(u.default,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,step:this.state.step,values:this.state.values,disabled:this.state.disabled,viewport:this.props.viewport,mapboxApiAccessToken:this.props.payload.data.mapboxApiKey,mapStyle:this.props.slice.formData.mapbox_style,setControlValue:this.props.setControlValue}))}}]),t}(a.default.PureComponent);v.propTypes=h,e.exports={default:function(e,t,r){var n=e.formData,i=Object.assign({},n.viewport,{width:e.width(),height:e.height()});n.autozoom&&(i=l.fitViewport(i,t.data.features.map((function(e){return e.position})))),o.default.render(a.default.createElement(v,{slice:e,payload:t,setControlValue:r,viewport:i}),document.getElementById(e.containerId))},getLayer:d}},2448:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(r(1)),i=l(r(0)),s=l(r(2472)),u=l(r(2446));function l(e){return e&&e.__esModule?e:{default:e}}r(2480);var p={viewport:i.default.object.isRequired,layers:i.default.array.isRequired,setControlValue:i.default.func.isRequired,mapStyle:i.default.string,mapboxApiAccessToken:i.default.string.isRequired,onViewportChange:i.default.func},f={mapStyle:"light",onViewportChange:function(){}},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={viewport:e.viewport},r.tick=r.tick.bind(r),r.onViewportChange=r.onViewportChange.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillMount",value:function(){var e=setInterval(this.tick,1e3);this.setState((function(){return{timer:e}}))}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState((function(){return{viewport:Object.assign({},e.viewport),previousViewport:t.state.viewport}}))}},{key:"componentWillUnmount",value:function(){this.clearInterval(this.state.timer)}},{key:"onViewportChange",value:function(e){var t=Object.assign({},e);delete t.width,delete t.height;var r=Object.assign({},this.state.viewport,t);this.setState((function(){return{viewport:r}})),this.props.onViewportChange(r)}},{key:"tick",value:function(){var e=this;if(this.state.previousViewport!==this.state.viewport){var t=this.props.setControlValue,r=this.state.viewport;t&&t("viewport",r),this.setState((function(){return{previousViewport:e.state.viewport}}))}}},{key:"layers",value:function(){return this.props.layers.some((function(e){return"function"==typeof e}))?this.props.layers.map((function(e){return"function"==typeof e?e():e})):this.props.layers}},{key:"render",value:function(){var e=this.state.viewport;return o.default.createElement(s.default,n({},e,{mapStyle:this.props.mapStyle,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiAccessToken}),o.default.createElement(u.default,n({},e,{layers:this.layers(),initWebGLParameters:!0})))}}]),t}(o.default.Component);t.default=c,c.propTypes=p,c.defaultProps=f},2449:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBounds=s,t.fitViewport=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{var n=s(t);return Object.assign({},e,(0,a.fitBounds)({height:e.height,width:e.width,padding:r,bounds:n}))}catch(t){return console.error("Could not auto zoom",t),e}},t.commonLayerProps=function(e,t){var r=e,a=void 0;if(r.js_tooltip){var i=(0,o.default)(r.js_tooltip);a=function(e){e.picked?t.setTooltip({content:n.default.sanitize(i(e)),x:e.x,y:e.y}):t.setTooltip(null)}}var s=void 0;r.js_onclick_href&&(s=function(e){var t=(0,o.default)(r.js_onclick_href)(e);window.open(t)});return{onClick:s,onHover:a,pickable:Boolean(a)}};var n=i(r(2461)),a=r(2457),o=i(r(611));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=d3.extent(e,(function(e){return e[1]})),r=d3.extent(e,(function(e){return e[0]}));return[[r[0],t[0]],[r[1],t[1]]]}},2477:function(e,t){},2478:function(e,t){},2479:function(e,t){},2533:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(r(1)),i=l(r(0)),s=l(r(2448)),u=l(r(2560));function l(e){return e&&e.__esModule?e:{default:e}}var p={getLayers:i.default.func.isRequired,start:i.default.number.isRequired,end:i.default.number.isRequired,step:i.default.number.isRequired,values:i.default.array.isRequired,disabled:i.default.bool,viewport:i.default.object.isRequired,children:i.default.node},f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=(e.getLayers,e.start,e.end,e.step,e.values),a=(e.disabled,e.viewport),o=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["getLayers","start","end","step","values","disabled","viewport"]);return r.state={values:n,viewport:a},r.other=o,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({values:e.values,viewport:e.viewport})}},{key:"render",value:function(){var e=this,t=this.props.getLayers(this.state.values);return o.default.createElement("div",null,o.default.createElement(s.default,n({},this.other,{viewport:this.state.viewport,layers:t,onViewportChange:function(t){return e.setState({viewport:t})}})),!this.props.disabled&&o.default.createElement(u.default,{start:this.props.start,end:this.props.end,step:this.props.step,values:this.state.values,onChange:function(t){return e.setState({values:t})}}),this.props.children)}}]),t}(o.default.Component);t.default=f,f.propTypes=p,f.defaultProps={disabled:!1,step:1}},2534:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlaySliderParams=void 0;var n,a=r(2672),o=(n=a)&&n.__esModule?n:{default:n};function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}t.getPlaySliderParams=function(e,t){var r=Math.min.apply(Math,i(e)),n=Math.max.apply(Math,i(e)),a=void 0;if(t.indexOf("/")>0){var s=t.split("/",2),u=void 0;s[0].endsWith("Z")?(u=new Date(s[0]).getTime(),a=(0,o.default)(s[1])):(u=new Date(s[1]).getTime(),a=(0,o.default)(s[0])),r=u+a*Math.floor((r-u)/a),n=u+a*(Math.floor((n-u)/a)+1)}else r-=r%(a=(0,o.default)(t)),n+=a-n%a;return{start:r,end:n,step:a,values:null!=t?[r,r+a]:[r,n],disabled:e.every((function(e){return null===e}))}}},2560:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=p(r(1)),o=p(r(0)),i=r(11),s=p(r(1071));r(2668);var u=p(r(2669));r(2561);var l=r(10);function p(e){return e&&e.__esModule?e:{default:e}}var f={start:o.default.number.isRequired,step:o.default.number.isRequired,end:o.default.number.isRequired,values:o.default.array.isRequired,onChange:o.default.func,loopDuration:o.default.number,maxFrames:o.default.number,orientation:o.default.oneOf(["horizontal","vertical"]),reversed:o.default.bool,disabled:o.default.bool},c={onChange:function(){},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.state={intervalId:null};var n=e.end-e.start,a=Math.min(e.maxFrames,n/e.step),o=n/a;return r.intervalMilliseconds=e.loopDuration/a,r.increment=o<e.step?e.step:o-o%e.step,r.onChange=r.onChange.bind(r),r.play=r.play.bind(r),r.pause=r.pause.bind(r),r.step=r.step.bind(r),r.getPlayClass=r.getPlayClass.bind(r),r.formatter=r.formatter.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"componentDidMount",value:function(){s.default.bind(["space"],this.play)}},{key:"componentWillUnmount",value:function(){s.default.unbind(["space"])}},{key:"onChange",value:function(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}},{key:"getPlayClass",value:function(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}},{key:"play",value:function(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var e=setInterval(this.step,this.intervalMilliseconds);this.setState({intervalId:e})}}},{key:"pause",value:function(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}},{key:"step",value:function(){var e=this;if(!this.props.disabled){var t=this.props.values.map((function(t){return t+e.increment}));if(t[1]>this.props.end){var r=t[0]-this.props.start;t=t.map((function(e){return e-r}))}this.props.onChange(t)}}},{key:"formatter",value:function(e){if(this.props.disabled)return(0,l.t)("Data has no time steps");var t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map((function(e){return new Date(e).toUTCString()})).join(" : ")}},{key:"render",value:function(){return a.default.createElement(i.Row,{className:"play-slider"},a.default.createElement(i.Col,{md:1,className:"padded"},a.default.createElement("i",{className:this.getPlayClass(),onClick:this.play}),a.default.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.step})),a.default.createElement(i.Col,{md:11,className:"padded"},a.default.createElement(u.default,{value:this.props.values,formatter:this.formatter,change:this.onChange,min:this.props.start,max:this.props.end,step:this.props.step,orientation:this.props.orientation,reversed:this.props.reversed,disabled:this.props.disabled?"disabled":"enabled"})))}}]),t}(a.default.PureComponent);t.default=d,d.propTypes=f,d.defaultProps=c},2561:function(e,t,r){}}]);