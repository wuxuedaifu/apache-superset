(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{1074:function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=v(r(1)),a=v(r(13)),i=v(r(0)),s=r(2446),u=v(r(2533)),l=v(r(2670)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(2449)),p=r(244),f=r(2534),d=r(414),h=v(r(611));function v(e){return e&&e.__esModule?e:{default:e}}function y(e,t,r,n){var o=e,a=o.color_picker||{r:0,g:0,b:0,a:1},i=[a.r,a.g,a.b,255*a.a],u=t.data.features.map((function(e){var t=(0,d.unitToRadius)(o.point_unit,e.radius)||10;o.multiplier&&(t*=o.multiplier);var r=void 0;return r=o.dimension?(0,p.hexToRGB)((0,p.getColorFromScheme)(e.cat_color,o.color_scheme),255*a.a):i,Object.assign({},e,{radius:t,color:r})}));if(o.js_data_mutator){var l=(0,h.default)(o.js_data_mutator);u=l(u)}return null!=n&&n.forEach((function(e){u=u.filter(e)})),new s.ScatterplotLayer(Object.assign({id:"scatter-layer-"+o.slice_id,data:u,fp64:!0,radiusMinPixels:o.min_radius||null,radiusMaxPixels:o.max_radius||null,outline:!1},c.commonLayerProps(o,r)))}var b={slice:i.default.object.isRequired,payload:i.default.object.isRequired,setControlValue:i.default.func.isRequired,viewport:i.default.object.isRequired},m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state=t.getDerivedStateFromProps(e),r.getLayers=r.getLayers.bind(r),r.toggleCategory=r.toggleCategory.bind(r),r.showSingleCategory=r.showSingleCategory.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,null,[{key:"getDerivedStateFromProps",value:function(e){var t=e.slice.formData,r=t.time_grain_sqla||t.granularity||"PT1M",n=e.payload.data.features.map((function(e){return e.__timestamp})),o=(0,f.getPlaySliderParams)(n,r);return{start:o.start,end:o.end,step:o.step,values:o.values,disabled:o.disabled,categories:function(e,t){var r=e,n=r.color_picker||{r:0,g:0,b:0,a:1},o=[n.r,n.g,n.b,255*n.a],a={};return t.data.features.forEach((function(e){if(null!=e.cat_color&&!a.hasOwnProperty(e.cat_color)){var t=void 0;t=r.dimension?(0,p.hexToRGB)((0,p.getColorFromScheme)(e.cat_color,r.color_scheme),255*n.a):o,a[e.cat_color]={color:t,enabled:!0}}})),a}(t,e.payload)}}}]),n(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(t.getDerivedStateFromProps(e,this.state))}},{key:"getLayers",value:function(e){var t=this,r=[];return e[0]===e[1]||e[1]===this.end?r.push((function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]})):r.push((function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]})),this.props.slice.formData.dimension&&r.push((function(e){return t.state.categories[e.cat_color].enabled})),[y(this.props.slice.formData,this.props.payload,this.props.slice,r)]}},{key:"toggleCategory",value:function(e){var t=this.state.categories[e];t.enabled=!t.enabled;var r,n,o,a=Object.assign({},this.state.categories,(o=t,(n=e)in(r={})?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,r));Object.values(a).every((function(e){return!e.enabled}))&&Object.values(a).forEach((function(e){e.enabled=!0})),this.setState({categories:a})}},{key:"showSingleCategory",value:function(e){var t=Object.assign({},this.state.categories);Object.values(t).forEach((function(e){e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})}},{key:"render",value:function(){return o.default.createElement("div",null,o.default.createElement(u.default,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,step:this.state.step,values:this.state.values,disabled:this.state.disabled,viewport:this.props.viewport,mapboxApiAccessToken:this.props.payload.data.mapboxApiKey,mapStyle:this.props.slice.formData.mapbox_style,setControlValue:this.props.setControlValue},o.default.createElement(l.default,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.slice.formData.legend_position})))}}]),t}(o.default.PureComponent);m.propTypes=b,e.exports={default:function(e,t,r){var n=e.formData,i=Object.assign({},n.viewport,{width:e.width(),height:e.height()});n.autozoom&&(i=c.fitViewport(i,t.data.features.map((function(e){return e.position})))),a.default.render(o.default.createElement(m,{slice:e,payload:t,setControlValue:r,viewport:i}),document.getElementById(e.containerId))},getLayer:y}},2448:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=l(r(1)),i=l(r(0)),s=l(r(2472)),u=l(r(2446));function l(e){return e&&e.__esModule?e:{default:e}}r(2480);var c={viewport:i.default.object.isRequired,layers:i.default.array.isRequired,setControlValue:i.default.func.isRequired,mapStyle:i.default.string,mapboxApiAccessToken:i.default.string.isRequired,onViewportChange:i.default.func},p={mapStyle:"light",onViewportChange:function(){}},f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={viewport:e.viewport},r.tick=r.tick.bind(r),r.onViewportChange=r.onViewportChange.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"componentWillMount",value:function(){var e=setInterval(this.tick,1e3);this.setState((function(){return{timer:e}}))}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState((function(){return{viewport:Object.assign({},e.viewport),previousViewport:t.state.viewport}}))}},{key:"componentWillUnmount",value:function(){this.clearInterval(this.state.timer)}},{key:"onViewportChange",value:function(e){var t=Object.assign({},e);delete t.width,delete t.height;var r=Object.assign({},this.state.viewport,t);this.setState((function(){return{viewport:r}})),this.props.onViewportChange(r)}},{key:"tick",value:function(){var e=this;if(this.state.previousViewport!==this.state.viewport){var t=this.props.setControlValue,r=this.state.viewport;t&&t("viewport",r),this.setState((function(){return{previousViewport:e.state.viewport}}))}}},{key:"layers",value:function(){return this.props.layers.some((function(e){return"function"==typeof e}))?this.props.layers.map((function(e){return"function"==typeof e?e():e})):this.props.layers}},{key:"render",value:function(){var e=this.state.viewport;return a.default.createElement(s.default,n({},e,{mapStyle:this.props.mapStyle,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiAccessToken}),a.default.createElement(u.default,n({},e,{layers:this.layers(),initWebGLParameters:!0})))}}]),t}(a.default.Component);t.default=f,f.propTypes=c,f.defaultProps=p},2449:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBounds=s,t.fitViewport=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{var n=s(t);return Object.assign({},e,(0,o.fitBounds)({height:e.height,width:e.width,padding:r,bounds:n}))}catch(t){return console.error("Could not auto zoom",t),e}},t.commonLayerProps=function(e,t){var r=e,o=void 0;if(r.js_tooltip){var i=(0,a.default)(r.js_tooltip);o=function(e){e.picked?t.setTooltip({content:n.default.sanitize(i(e)),x:e.x,y:e.y}):t.setTooltip(null)}}var s=void 0;r.js_onclick_href&&(s=function(e){var t=(0,a.default)(r.js_onclick_href)(e);window.open(t)});return{onClick:s,onHover:o,pickable:Boolean(o)}};var n=i(r(2461)),o=r(2457),a=i(r(611));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=d3.extent(e,(function(e){return e[1]})),r=d3.extent(e,(function(e){return e[0]}));return[[r[0],t[0]],[r[1],t[1]]]}},2477:function(e,t){},2478:function(e,t){},2479:function(e,t){},2533:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=l(r(1)),i=l(r(0)),s=l(r(2448)),u=l(r(2560));function l(e){return e&&e.__esModule?e:{default:e}}var c={getLayers:i.default.func.isRequired,start:i.default.number.isRequired,end:i.default.number.isRequired,step:i.default.number.isRequired,values:i.default.array.isRequired,disabled:i.default.bool,viewport:i.default.object.isRequired,children:i.default.node},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=(e.getLayers,e.start,e.end,e.step,e.values),o=(e.disabled,e.viewport),a=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["getLayers","start","end","step","values","disabled","viewport"]);return r.state={values:n,viewport:o},r.other=a,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({values:e.values,viewport:e.viewport})}},{key:"render",value:function(){var e=this,t=this.props.getLayers(this.state.values);return a.default.createElement("div",null,a.default.createElement(s.default,n({},this.other,{viewport:this.state.viewport,layers:t,onViewportChange:function(t){return e.setState({viewport:t})}})),!this.props.disabled&&a.default.createElement(u.default,{start:this.props.start,end:this.props.end,step:this.props.step,values:this.state.values,onChange:function(t){return e.setState({values:t})}}),this.props.children)}}]),t}(a.default.Component);t.default=p,p.propTypes=c,p.defaultProps={disabled:!1,step:1}},2534:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlaySliderParams=void 0;var n,o=r(2672),a=(n=o)&&n.__esModule?n:{default:n};function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}t.getPlaySliderParams=function(e,t){var r=Math.min.apply(Math,i(e)),n=Math.max.apply(Math,i(e)),o=void 0;if(t.indexOf("/")>0){var s=t.split("/",2),u=void 0;s[0].endsWith("Z")?(u=new Date(s[0]).getTime(),o=(0,a.default)(s[1])):(u=new Date(s[1]).getTime(),o=(0,a.default)(s[0])),r=u+o*Math.floor((r-u)/o),n=u+o*(Math.floor((n-u)/o)+1)}else r-=r%(o=(0,a.default)(t)),n+=o-n%o;return{start:r,end:n,step:o,values:null!=t?[r,r+o]:[r,n],disabled:e.every((function(e){return null===e}))}}},2560:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=c(r(1)),a=c(r(0)),i=r(11),s=c(r(1071));r(2668);var u=c(r(2669));r(2561);var l=r(10);function c(e){return e&&e.__esModule?e:{default:e}}var p={start:a.default.number.isRequired,step:a.default.number.isRequired,end:a.default.number.isRequired,values:a.default.array.isRequired,onChange:a.default.func,loopDuration:a.default.number,maxFrames:a.default.number,orientation:a.default.oneOf(["horizontal","vertical"]),reversed:a.default.bool,disabled:a.default.bool},f={onChange:function(){},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.state={intervalId:null};var n=e.end-e.start,o=Math.min(e.maxFrames,n/e.step),a=n/o;return r.intervalMilliseconds=e.loopDuration/o,r.increment=a<e.step?e.step:a-a%e.step,r.onChange=r.onChange.bind(r),r.play=r.play.bind(r),r.pause=r.pause.bind(r),r.step=r.step.bind(r),r.getPlayClass=r.getPlayClass.bind(r),r.formatter=r.formatter.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"componentDidMount",value:function(){s.default.bind(["space"],this.play)}},{key:"componentWillUnmount",value:function(){s.default.unbind(["space"])}},{key:"onChange",value:function(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}},{key:"getPlayClass",value:function(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}},{key:"play",value:function(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var e=setInterval(this.step,this.intervalMilliseconds);this.setState({intervalId:e})}}},{key:"pause",value:function(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}},{key:"step",value:function(){var e=this;if(!this.props.disabled){var t=this.props.values.map((function(t){return t+e.increment}));if(t[1]>this.props.end){var r=t[0]-this.props.start;t=t.map((function(e){return e-r}))}this.props.onChange(t)}}},{key:"formatter",value:function(e){if(this.props.disabled)return(0,l.t)("Data has no time steps");var t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map((function(e){return new Date(e).toUTCString()})).join(" : ")}},{key:"render",value:function(){return o.default.createElement(i.Row,{className:"play-slider"},o.default.createElement(i.Col,{md:1,className:"padded"},o.default.createElement("i",{className:this.getPlayClass(),onClick:this.play}),o.default.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.step})),o.default.createElement(i.Col,{md:11,className:"padded"},o.default.createElement(u.default,{value:this.props.values,formatter:this.formatter,change:this.onChange,min:this.props.start,max:this.props.end,step:this.props.step,orientation:this.props.orientation,reversed:this.props.reversed,disabled:this.props.disabled?"disabled":"enabled"})))}}]),t}(o.default.PureComponent);t.default=d,d.propTypes=p,d.defaultProps=f},2561:function(e,t,r){},2670:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=s(r(1)),i=s(r(0));function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}r(2671);var p={categories:i.default.object,toggleCategory:i.default.func,showSingleCategory:i.default.func,position:i.default.oneOf(["tl","tr","bl","br"])},f={categories:{},toggleCategory:function(){},showSingleCategory:function(){},position:"tr"},d=function(e){function t(){return l(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e,t=this;if(0===Object.keys(this.props.categories).length)return null;var r=Object.entries(this.props.categories).map((function(e){var r=n(e,2),o=r[0],i=r[1],s={color:"rgba("+i.color.join(", ")+")"},u=i.enabled?"●":"○";return a.default.createElement("li",null,a.default.createElement("a",{href:"#",onClick:function(){return t.props.toggleCategory(o)},onDoubleClick:function(){return t.props.showSingleCategory(o)}},a.default.createElement("span",{style:s},u)," ",o))})),o="t"===this.props.position.charAt(0)?"top":"bottom",i="r"===this.props.position.charAt(1)?"right":"left",s=(u(e={},o,"0px"),u(e,i,"10px"),e);return a.default.createElement("div",{className:"legend",style:s},a.default.createElement("ul",{className:"categories"},r))}}]),t}(a.default.PureComponent);t.default=d,d.propTypes=p,d.defaultProps=f},2671:function(e,t,r){}}]);